(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};e.d({},{l:()=>St});class s{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)}invoke(t){for(const e of this.listeners)e(t)}}class i{static init(){this.scenes=[]}static update(){for(const t of this.scenes)t.active&&t.update()}static registerScene(t){0===this.scenes.length&&t.setActive(!0),this.scenes.push(t)}static getSceneByName(t){for(const e of this.scenes)if(e.name===t)return e;return null}static loadScene(t){for(const e of this.scenes)if(e===t)e.setActive(!0);else{for(const s of e.gameObjects)s.dontDestroyOnLoad&&(e.unregisterGameObject(s),t.registerGameObject(s));e.setActive(!1)}}}!function(t){t.READY="ready",t.PLAYING="playing",t.GAME_OVER="game_over",t.PAUSE="pause"}(t||(t={}));class o{static RandomFloat(t,e){return Math.random()*(e-t)+t}static RandomInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static RandomPercent(t){return this.RandomFloat(0,100)<=t}static Lerp(t,e,s){return t+(e-t)*Math.max(0,Math.min(1,s))}static WeightPick(t){let e=0;const s=[];for(let i=0;i<t.length;i++)e+=t[i],s[i]=e;const i=this.RandomFloat(0,1)*e;for(let t=0;t<s.length;t++)if(s[t]>=i)return t;return-1}}var a=function(t,e,s,i){return new(s||(s=Promise))((function(o,a){function n(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,r)}h((i=i.apply(t,e||[])).next())}))};class n{static init(){return a(this,void 0,void 0,(function*(){this.jumpAudio=yield this.loadAudio("assets/audios/jump.mp3"),this.hatAudio=yield this.loadAudio("assets/audios/propeller.mp3"),this.jetpackAudio=yield this.loadAudio("assets/audios/jetpack.mp3"),this.fallingAudio=yield this.loadAudio("assets/audios/falling.mp3"),this.monsterHitAudio=yield this.loadAudio("assets/audios/monster_hit.mp3"),this.holeAudio=yield this.loadAudio("assets/audios/black_hole.mp3"),this.springAudio=yield this.loadAudio("assets/audios/spring.mp3"),this.breakAudio=yield this.loadAudio("assets/audios/break_platform.mp3"),this.whiteAudio=yield this.loadAudio("assets/audios/white.mp3"),this.jumpOnMonsterAudio=yield this.loadAudio("assets/audios/jumponmonster.mp3")}))}static loadAudio(t){return a(this,void 0,void 0,(function*(){const e=yield fetch(t),s=yield e.blob(),i=URL.createObjectURL(s);return new Audio(i)}))}static playJumpSound(){this.jumpAudio.volume=.5,this.jumpAudio.playbackRate=o.RandomFloat(.9,1.1),this.jumpAudio.play().catch((()=>{}))}static playSpringSound(){this.springAudio.volume=.5,this.springAudio.playbackRate=o.RandomFloat(.9,1.1),this.springAudio.play()}static playWhiteSound(){this.whiteAudio.volume=.4,this.whiteAudio.playbackRate=o.RandomFloat(.9,1.1),this.whiteAudio.play()}static playHatSound(){this.hatAudio.volume=.2,this.hatAudio.play()}static playJetpackSound(){this.jetpackAudio.volume=.2,this.jetpackAudio.play()}static playGameOverSound(){this.fallingAudio.volume=.2,this.fallingAudio.play()}static playMonsterHitSound(){this.monsterHitAudio.volume=.2,this.monsterHitAudio.play()}static playJumpOnMonsterSound(){this.jumpOnMonsterAudio.playbackRate=o.RandomFloat(.9,1.1),this.jumpOnMonsterAudio.play(),this.jumpOnMonsterAudio.volume=.2}static playHoleSound(){this.holeAudio.volume=.2,this.holeAudio.play()}static playBreakSound(){this.breakAudio.volume=.5,this.breakAudio.playbackRate=o.RandomFloat(.9,1.1),this.breakAudio.play()}}class r{static init(){this.OnGameStateChanged=new s}static updateGameState(e){switch(this.gameState=e,this.gameState){case t.READY:this.handleReadyState();break;case t.PLAYING:this.handlePlayingState();break;case t.GAME_OVER:n.playGameOverSound()}this.OnGameStateChanged.invoke(this.gameState)}static handleReadyState(){const t=i.getSceneByName("MainMenuScene");t&&i.loadScene(t)}static handlePlayingState(){const t=i.getSceneByName("GameplayScene");t&&i.loadScene(t)}static getGameState(){return this.gameState}}class h{static init(){h.startTime=window.performance.now(),h.lastFrameTime=0}static get time(){return(window.performance.now()-h.startTime)/1e3}static get deltaTime(){return(window.performance.now()-h.lastFrameTime)/1e3}}class c{static init(){this.buttons=[],this.texts=[]}static registerButton(t){this.buttons.push(t)}static registerText(t){this.texts.push(t)}}class l{static init(){this.sprites=[]}static registerSprite(t){this.sprites.push(t),this.sprites.sort(((t,e)=>e.order-t.order))}}class p{constructor(t,e){this._x=t,this._y=e}add(t){return new p(this._x+t._x,this._y+t._y)}sub(t){return new p(this._x-t._x,this._y-t._y)}mul(t){return new p(this._x*t,this._y*t)}static get zero(){return new p(0,0)}static get up(){return new p(0,1)}static get left(){return new p(-1,0)}static get right(){return new p(1,0)}get x(){return this._x}get y(){return this._y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalize(){const t=this.magnitude;return 0!==t?new p(this._x/t,this._y/t):p.zero}dot(t){return this._x*t._x+this._y*t._y}}class d{static init(t){this.canvas=document.getElementById(t),this.canvas.width=d.size.x,this.canvas.height=d.size.y,this.canvas.addEventListener("click",d.handleClick),this.context=this.canvas.getContext("2d")}static draw(){this.renderSprites(),this.renderUITexts()}static renderSprites(){if(d.context)for(const t of l.sprites){const e=t.gameObject;if(!e.active)continue;const s=this.size.x/2,i=this.size.y/2,o=t.width/2*e.transform.scale,a=t.height/2*e.transform.scale,n=e.transform.position.x+s,r=-e.transform.position.y+i;d.context.save(),d.context.globalCompositeOperation=t.blendMode,d.context.globalAlpha=t.alpha,d.context.translate(n,r),d.context.rotate(e.transform.rotation),t.flipX&&d.context.scale(-1,1),t.flipY&&d.context.scale(1,-1),t.image.complete&&0!==t.image.naturalWidth&&d.context.drawImage(t.image,-o,-a,t.width*e.transform.scale,t.height*e.transform.scale),d.context.restore()}}static renderUITexts(){if(d.context)for(const t of c.texts)t.active&&(d.context.font=t.font,d.context.fillText(t.text,t.transform.position.x+this.size.x/2,-t.transform.position.y+this.size.y/2))}static handleClick(t){const e=new p(t.offsetX-d.size.x/2,-t.offsetY+d.size.y/2);for(const t of c.buttons){if(!t.active)continue;const s=t.transform.position;e.x>=s.x-t.width/2&&e.x<=s.x+t.width/2&&e.y>=s.y-t.height/2&&e.y<=s.y+t.height/2&&t.onClick()}}}d.size=new p(320,512),d.sprites=[];class u{static init(){u.add("Default")}static add(t){m.registerInteractiveLayer(t),this.layers.push(t)}static remove(t){this.layers.splice(this.layers.indexOf(t))}}u.layers=[];class m{static get bounciness(){return.75}static registerCollider(t){m.colliders.push(t)}static registerInteractiveLayer(t){for(const e of u.layers)m.setInteractiveLayer(e,t,!0),m.setInteractiveLayer(t,e,!0);m.setInteractiveLayer(t,t,!0)}static setInteractiveLayer(t,e,s){m.interactiveLayers[`${t},${e}`]=s,m.interactiveLayers[`${e},${t}`]=s}static isInteractiveLayer(t,e){var s;return null!==(s=m.interactiveLayers[`${t},${e}`])&&void 0!==s&&s}static update(){const t=m.colliders.length;for(let e=0;e<t-1;e++){const s=m.colliders[e];if(s.gameObject.active)for(let i=e+1;i<t;i++){const t=m.colliders[i];if(!t.gameObject.active)continue;const e=s.gameObject.layer,o=t.gameObject.layer;m.isInteractiveLayer(e,o)&&m.checkCollision(s,t)&&(s.colliding(t),t.colliding(s))}}}static checkCollision(t,e){const s=t.gameObject.transform.position,i=e.gameObject.transform.position;return s.x+t.size.x/2>=i.x-e.size.x/2&&s.x-t.size.x/2<=i.x+e.size.x/2&&s.y+t.size.y/2>=i.y-e.size.y/2&&s.y-t.size.y/2<=i.y+e.size.y/2}}m.colliders=[],m.interactiveLayers={};class g{constructor(){this.position=new p(0,0)}}class y{static init(){const t=d.canvas;document.addEventListener("keydown",(t=>this.handleKeyDown(t))),document.addEventListener("keyup",(t=>this.handleKeyUp(t))),t.addEventListener("mousedown",(()=>this.handleMouseDown())),t.addEventListener("mouseup",(()=>this.handleMouseUp())),t.addEventListener("touchstart",this.handleTouchStart),t.addEventListener("touchend",this.handleTouchEnd),this.touch=new g,this.isTouching=!1,this.isHeld=!1}static getKeyDown(t){return this.previousKeyStates.has(t)}static getKey(t){return this.heldKeyStates.has(t)}static getMouseDown(){return this.isMouseDown}static handleKeyDown(t){const e=t.code;this.heldKeyStates.has(e)||this.heldKeyStates.add(e),this.isHeld||this.previousKeyStates.has(e)||(this.isHeld=!0,this.previousKeyStates.add(e))}static handleKeyUp(t){const e=t.code;this.isHeld=!1,this.heldKeyStates.delete(e)}static handleMouseDown(){this.isMouseDown=!0}static handleMouseUp(){this.isMouseDown=!1}static handleTouchStart(t){y.isTouching=!0;const e=t.target.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left,i=t.targetTouches[0].pageY-e.top;y.touch.position=new p(s-d.size.x/2,d.size.y/2-i)}static handleTouchEnd(){y.isTouching=!1}static getTouch(){return this.touch}static reset(){this.previousKeyStates.clear(),this.isMouseDown=!1}}y.previousKeyStates=new Set,y.heldKeyStates=new Set;class f{static init(){this.tweens=[]}static addTween(t){this.tweens.includes(t)||this.tweens.push(t)}static removeTween(t){const e=this.tweens.indexOf(t);-1!==e&&this.tweens.splice(e,1)}static update(){for(const t of this.tweens)t.update()}}var w,O,S;class b{static init(){this.images={}}static load(t){return e=this,s=void 0,o=function*(){const e=[],s=t=>new Promise((e=>{const s=new Image;s.src=t,this.images[t]=s,s.onload=()=>{e()}}));for(const i of t)e.push(s(i));yield Promise.all(e)},new((i=void 0)||(i=Promise))((function(t,a){function n(t){try{h(o.next(t))}catch(t){a(t)}}function r(t){try{h(o.throw(t))}catch(t){a(t)}}function h(e){var s;e.done?t(e.value):(s=e.value,s instanceof i?s:new i((function(t){t(s)}))).then(n,r)}h((o=o.apply(e,s||[])).next())}));var e,s,i,o}static getImage(t){return this.images[t]}}b.images={};class T{constructor(t){this.gameObject=t}update(){}destroy(){}}!function(t){t.COLOR="color",t.COLOR_BURN="color-burn",t.COLOR_DODGE="color-dodge",t.COPY="copy",t.DARKEN="darken",t.DESTINATION_ATOP="destination-atop",t.DESTINATION_IN="destination-in",t.DESTINATION_OUT="destination-out",t.DESTINATION_OVER="destination-over",t.DIFFERENCE="difference",t.EXCLUSION="exclusion",t.HARD_LIGHT="hard-light",t.HUE="hue",t.LIGHTEN="lighten",t.LIGHTER="lighter",t.LUMINOSITY="luminosity",t.MULTIPLY="multiply",t.OVERLAY="overlay",t.SATURATION="saturation",t.SCREEN="screen",t.SOFT_LIGHT="soft-light",t.SOURCE_ATOP="source-atop",t.SOURCE_IN="source-in",t.SOURCE_OUT="source-out",t.NORMAL="source-over",t.XOR="xor"}(w||(w={}));class v extends T{constructor(t,e){super(t),this.order=e||0,this.name="Sprite",this.flipX=!1,this.flipY=!1,this.alpha=1,this.blendMode=w.NORMAL,l.registerSprite(this)}setSprite(t){const e=b.getImage(t);void 0===e?(this.image=new Image,this.image.src=t):this.image=e}get width(){return this.image.width}get height(){return this.image.height}}class P extends T{constructor(t){super(t),this.OnCollisionStay=new s,this.OnTriggerStay=new s,this.scale=new p(1,1),this.isTrigger=!1,this.name="Collider",m.registerCollider(this)}get size(){const t=this.gameObject.getComponent("Sprite");return new p(t.width*this.scale.x,t.height*this.scale.y).mul(this.gameObject.transform.scale)}update(){super.update()}colliding(t){if(t.gameObject.active)if(this.isTrigger)this.OnTriggerStay.invoke(t);else{const e=this.gameObject.getComponent("RigidBody");if(!e)return;if(e.isStatic)return;const s=t.gameObject.getComponent("RigidBody"),i=(s?s.velocity:p.zero).sub(e.velocity.mul(m.bounciness));e.velocity=i.magnitude<.005?p.zero:i,this.OnCollisionStay.invoke(t)}}}class A extends T{constructor(t){super(t),this.name="Transform",this.worldPosition=p.zero,this.rotation=0,this.scale=1,this.localPosition=p.zero}update(){null!==this.gameObject.parent&&(this.position=this.gameObject.parent.transform.position.add(this.localPosition))}set position(t){this.localPosition=t.sub(this.gameObject.parent?this.gameObject.parent.transform.position:p.zero),this.worldPosition=t}get position(){return this.worldPosition}}class _{constructor(t){var e;this.parent=null,this.children=[],this.transform=new A(this),this.name=t,this.layer="Default",this.components={},this.isActive=!0,this.dontDestroyOnLoad=!1,this.addComponent(this.transform),St.registerGameObject(this),(null===(e=this.parent)||void 0===e?void 0:e.scene)&&this.parent.scene.registerGameObject(this)}update(){for(const t in this.components){const e=this.components[t];this.isActive&&e.update()}}addComponent(t){this.components[t.name]=t,t instanceof P&&(t.OnCollisionStay.subscribe(this.OnCollisionStay),t.OnTriggerStay.subscribe(this.OnTriggerStay))}getComponent(t){return this.components[t]}executeStart(){this.start();for(const t of this.children)t.executeStart()}executeUpdate(){if(this.isActive){this.update();for(const t of this.children)t.executeUpdate()}}setChild(t){this.children.includes(t)||(this.children.push(t),t.parent=this,this.scene&&this.scene.registerGameObject(t))}removeChild(t){const e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)}setParent(t){t.setChild(this)}setActive(t){this.isActive=t,this.isActive?this.onEnabled():this.onDisabled()}get active(){var t;return this.isActive&&(null===(t=this.scene)||void 0===t?void 0:t.active)}start(){}onEnabled(){}onDisabled(){}OnCollisionStay(t){}OnTriggerStay(t){}destroy(){this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy();St.unregisterGameObject(this)}}class x{constructor(t){this.name=t,this.gameObjects=[],this.active=!1,i.registerScene(this)}update(){if(this.active)for(const t of this.gameObjects)t.update()}setActive(t){this.active=t}registerGameObject(t){this.gameObjects.push(t),t.scene=this}unregisterGameObject(t){this.gameObjects.slice(this.gameObjects.indexOf(t),1)}}!function(t){t.LINEAR="linear",t.IN_SINE="in_sine",t.OUT_SINE="out_sine",t.IN_OUT_SINE="in_out_sine",t.IN_QUAD="in_quad",t.OUT_QUAD="out_quad",t.IN_OUT_QUAD="in_out_quad",t.IN_CUBIC="in_cubic",t.OUT_CUBIC="out_cubic",t.IN_OUT_CUBIC="in_out_cubic",t.IN_QUART="in_quart",t.OUT_QUART="out_quart",t.IN_OUT_QUART="in_out_quart",t.IN_QUINT="in_quint",t.OUT_QUINT="out_quint",t.IN_OUT_QUINT="in_out_quint",t.IN_EXPO="in_expo",t.OUT_EXPO="out_expo",t.IN_OUT_EXPO="in_out_expo",t.IN_CIRC="in_circ",t.OUT_CIRC="out_circ",t.IN_OUT_CIRC="in_out_circ",t.IN_ELASTIC="in_elastic",t.OUT_ELASTIC="out_elastic",t.IN_OUT_ELASTIC="in_out_elastic",t.IN_BACK="in_back",t.OUT_BACK="out_back",t.IN_OUT_BACK="in_out_back",t.IN_BOUNCE="in_bounce",t.OUT_BOUNCE="out_bounce",t.IN_OUT_BOUNCE="in_out_bounce"}(O||(O={})),function(t){t[t.RESTART=0]="RESTART",t[t.YOYO=1]="YOYO"}(S||(S={}));const C=1.70158,I=1.525*C,j=C+1,U=2*Math.PI/3,R=2*Math.PI/4.5,E=7.5625,B=2.75;class M{static EaseFuction(t,e){switch(t){case O.LINEAR:return e;case O.IN_SINE:return 1-Math.cos(e*Math.PI/2);case O.OUT_SINE:return Math.sin(e*Math.PI/2);case O.IN_OUT_SINE:return.5*(1-Math.cos(Math.PI*e/2));case O.IN_QUAD:return e*e;case O.OUT_QUAD:return-e*(e-2);case O.IN_OUT_QUAD:return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2;case O.IN_CUBIC:return e*e*e;case O.OUT_CUBIC:return(e-1)*(e-1)*(e-1)+1;case O.IN_OUT_CUBIC:return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;case O.IN_QUART:return e*e*e*e;case O.OUT_QUART:return 1-Math.pow(1-e,4);case O.IN_OUT_QUART:return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2;case O.IN_QUINT:return e*e*e*e*e;case O.OUT_QUINT:return 1-Math.pow(1-e,5);case O.IN_OUT_QUINT:return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2;case O.IN_EXPO:return 0===e?0:Math.pow(2,10*e-10);case O.OUT_EXPO:return 1===e?1:1-Math.pow(2,-10*e);case O.IN_OUT_EXPO:return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2;case O.IN_CIRC:return 1-Math.sqrt(1-Math.pow(e,2));case O.OUT_CIRC:return Math.sqrt(1-Math.pow(e-1,2));case O.IN_OUT_CIRC:return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2;case O.IN_BACK:return j*e*e*e-C*e*e;case O.OUT_BACK:return 1+j*Math.pow(e-1,3)+C*Math.pow(e-1,2);case O.IN_OUT_BACK:return e<.5?Math.pow(2*e,2)*(7.189819*e-I)/2:(Math.pow(2*e-2,2)*((I+1)*(2*e-2)+I)+2)/2;case O.IN_ELASTIC:return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*U);case O.OUT_ELASTIC:return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*U)+1;case O.IN_OUT_ELASTIC:return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*R)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*R)/2+1;case O.IN_BOUNCE:return 1-this.easeOutBounce(1-e);case O.OUT_BOUNCE:return this.easeOutBounce(e);case O.IN_OUT_BOUNCE:return e<.5?(1-this.easeOutBounce(1-2*e))/2:(1+this.easeOutBounce(2*e-1))/2;default:return e}}static easeOutBounce(t){return t<1/B?E*t*t:t<2/B?E*(t-=1.5/B)*t+.75:t<2.5/B?E*(t-=2.25/B)*t+.9375:E*(t-=2.625/B)*t+.984375}}class G{constructor(t,e){this.target=t,this.duration=e,this.easing=O.LINEAR,this.startTime=h.time,this.loopCount=1,this.loopType=S.RESTART,this.isYoyoReverse=!1,this.numberProperties={},this.Vector2Properties={},f.addTween(this)}to(t){for(const e in t)if(this.target[e]instanceof p){const s=this.target[e],i=t[e].sub(s);this.Vector2Properties[e]={start:s,delta:i}}else if(Object.prototype.hasOwnProperty.call(this.target,e)){const s=this.target[e],i=t[e]-s;this.numberProperties[e]={start:s,delta:i}}return this}setEasing(t){return this.easing=t,this}setLoops(t,e=S.RESTART){return this.loopCount=t,this.loopType=e,this}onComplete(t){return this.onCompleteCallback=t,this}update(){const t=h.time-this.startTime,e=Math.min(t/this.duration,1);for(const t in this.Vector2Properties)if(Object.prototype.hasOwnProperty.call(this.Vector2Properties,t)&&this.target[t]instanceof p){const s=this.Vector2Properties[t],i=s.delta.mul(M.EaseFuction(this.easing,e)).add(s.start);this.target[t]=i}for(const t in this.numberProperties)if(Object.prototype.hasOwnProperty.call(this.numberProperties,t)){const s=this.numberProperties[t],i=M.EaseFuction(this.easing,e)*s.delta+s.start;this.target[t]=i}e>=1&&(this.loopCount>1?(this.loopCount--,this.startTime=h.time,this.loopType===S.YOYO&&(this.isYoyoReverse=!this.isYoyoReverse,this.reverseProperties())):-1===this.loopCount?(this.startTime=h.time,this.loopType===S.YOYO&&(this.isYoyoReverse=!this.isYoyoReverse,this.reverseProperties())):this.complete())}reverseProperties(){for(const t in this.Vector2Properties)if(Object.prototype.hasOwnProperty.call(this.Vector2Properties,t)){const e=this.Vector2Properties[t];e.start=e.start.add(e.delta),e.delta=e.delta.mul(-1)}for(const t in this.numberProperties)if(Object.prototype.hasOwnProperty.call(this.numberProperties,t)){const e=this.numberProperties[t];e.start+=e.delta,e.delta=-e.delta}}complete(){var t;this.destroy();for(const t in this.numberProperties)Object.prototype.hasOwnProperty.call(this.numberProperties,t)&&delete this.numberProperties[t];null===(t=this.onCompleteCallback)||void 0===t||t.call(this.onCompleteCallback)}destroy(){f.removeTween(this)}}class N extends _{constructor(){super("Background"),this.transform.scale=.5;const t=new v(this,3);t.setSprite("assets/images/bck.png"),this.addComponent(t)}}class k extends _{constructor(){super("BasePlatform"),this.onDisabled=()=>{this.powerUp&&this.powerUp.setActive(!1)};const t=new P(this);t.isTrigger=!0,this.sprite=new v(this,2),this.sprite.setSprite("assets/images/green-platform.png"),this.addComponent(this.sprite),this.addComponent(t)}addPowerUp(t){this.setChild(t);const e=t.getComponent("Sprite");t.transform.localPosition=new p(o.RandomFloat(-this.sprite.width/2+e.width/2,this.sprite.width/2-e.width/2),this.sprite.height/2+e.height/2-2),this.powerUp=t}}var D;!function(t){t[t.Force=0]="Force",t[t.VelocityChange=1]="VelocityChange"}(D||(D={}));class L extends T{constructor(t,e){super(t),this.name="RigidBody",this.gravityScale=e||1,this.velocity=p.zero,this.isStatic=!1}addForce(t,e=D.Force){e==D.Force?this.velocity=this.velocity.add(t):e==D.VelocityChange&&(this.velocity=new p(t.x,t.y))}update(){this.gravityScale&&(this.velocity=this.velocity.add(new p(0,-100*this.gravityScale).mul(h.deltaTime))),this.velocity.magnitude>.1&&(this.gameObject.transform.position=this.gameObject.transform.position.add(this.velocity.mul(100*h.deltaTime)))}}class z{constructor(t,e,s){this.pool=[],this.createObject=t,this.getObject=e,this.resetObject=s}get(){let t=null;return t=0===this.pool.length?this.createObject():this.pool.pop(),this.getObject(t),t}release(t){-1===this.pool.indexOf(t)&&(this.resetObject(t),this.pool.push(t))}clear(){this.pool.length=0}}class F extends _{constructor(){super("Hole"),this.sprite=new v(this,2),this.sprite.setSprite("assets/images/hole.png");const t=new P(this);t.isTrigger=!0,t.scale=new p(.1,.1),this.addComponent(this.sprite),this.addComponent(t)}update(){super.update(),this.transform.position.y+this.sprite.height/2<-d.size.y/2&&ot.holePool.release(this)}}const Y=["assets/images/monster-1.png","assets/images/monster-2.png"];class H extends _{constructor(){super("Monster");const t=new P(this);t.isTrigger=!0,this.sprite=new v(this,2),this.sprite.setSprite(Y[o.RandomInt(0,Y.length-1)]),this.addComponent(t),this.addComponent(this.sprite)}update(){super.update(),this.transform.position.y+this.sprite.height/2<-d.size.y/2&&ot.monsterPool.release(this)}}const K=new p(50,200);class V extends k{constructor(){super(),this.name="BluePlatform",this.sprite.setSprite("assets/images/blue-platform.png"),this.moveDirection=p.right}update(){super.update(),this.transform.position.x>d.size.x/2?this.moveDirection=p.left:this.transform.position.x<-d.size.x/2&&(this.moveDirection=p.right),this.transform.position=this.transform.position.add(this.moveDirection.mul(o.RandomFloat(K.x,K.y)*h.deltaTime))}}const Q=["assets/images/brown-platform-0.png","assets/images/brown-platform-1.png","assets/images/brown-platform-2.png","assets/images/brown-platform-3.png"];class q extends k{constructor(){super(),this.name="BrownPlatform",this.sprite.setSprite(Q[0]),this.spriteIndex=0,this.isBreaking=!1,this.timer=.02,this.rigidBody=new L(this,0),this.addComponent(this.rigidBody)}onEnabled(){super.onEnabled(),this.isBreaking=!1,this.rigidBody.gravityScale=0,this.rigidBody.velocity=p.zero,this.spriteIndex=0,this.sprite.setSprite(Q[0])}setIsBreaking(t){this.isBreaking!==t&&(this.isBreaking=t,this.isBreaking&&(n.playBreakSound(),this.rigidBody.gravityScale=.08))}update(){super.update(),this.timer-=h.deltaTime,this.isBreaking&&this.timer<0&&(this.timer=.02,++this.spriteIndex<Q.length&&this.sprite.setSprite(Q[this.spriteIndex]))}}class X extends k{constructor(){super(),this.name="WhitePlatform",this.sprite.setSprite("assets/images/white-platform.png")}}class J{static getPlaformTypes(t){for(const e in this.scoreToPlatformTypeSpawn)if(t<parseFloat(e))return this.scoreToPlatformTypeSpawn[e];const e=Object.keys(this.scoreToPlatformTypeSpawn),s=e[e.length-1];return this.scoreToPlatformTypeSpawn[parseFloat(s)]}static getObstacleTypes(t){for(const e in this.obstacleSpawnChances)if(t<parseFloat(e))return this.obstacleSpawnChances[e];const e=Object.keys(this.obstacleSpawnChances),s=e[e.length-1];return this.obstacleSpawnChances[parseFloat(s)]}static getPlatfomSpawnDistances(t){for(const e in this.scoreToPlatfomSpawnDistances)if(t<parseFloat(e))return this.scoreToPlatfomSpawnDistances[e];const e=Object.keys(this.scoreToPlatfomSpawnDistances),s=e[e.length-1];return this.scoreToPlatfomSpawnDistances[parseFloat(s)]}}J.powerUpSpawnChances=[85,10,5],J.obstacleSpawnChances={8e3:[100,0,0],1e4:[55,5,35],15e3:[50,10,40]},J.scoreToPlatfomSpawnDistances={1e3:new p(20,50),3e3:new p(20,55),6e3:new p(20,60),8e3:new p(20,70),1e4:new p(20,80),15e3:new p(30,90),2e4:new p(30,100)},J.scoreToPlatformTypeSpawn={1e3:[90,10,0,0],4e3:[85,10,5,0],8e3:[60,10,40,0],12e3:[30,10,70,0],2e4:[50,10,10,30]};class W extends _{constructor(){super("Text"),this.text="",this.font="28px Arial",c.registerText(this)}}class $ extends _{constructor(){super("ScoreManager"),this.enviroment=St.Find("Enviroment"),this.scoreText=new W,this.scoreText.font="600 32px DoodleJump",this.scoreText.transform.position=new p(-150,230),this.scoreText.name="ScoreText";const t=i.getSceneByName("GameplayScene");t&&t.registerGameObject(this.scoreText),$.score=0,$.highScore=0}update(){super.update(),r.getGameState()===t.PLAYING?($.score=this.enviroment.point()<=0?0:Math.floor(this.enviroment.point()),this.scoreText.text=$.score.toString(),$.score>$.highScore&&($.highScore=$.score)):$.score=0}static getScore(){return this.score}static getHighScore(){return this.highScore}}class Z extends _{constructor(){super("Hat");const t=new v(this,2);t.setSprite("assets/images/hat.png");const e=new P(this);e.isTrigger=!0,this.addComponent(t),this.addComponent(e)}}class tt extends _{constructor(){super("Jetpack");const t=new v(this,2);t.setSprite("assets/images/jetpack.png");const e=new P(this);this.addComponent(e),this.addComponent(t)}}class et extends _{constructor(){super("Spring"),this.sprite=new v(this,2),this.sprite.setSprite("assets/images/spring-0.png");const t=new P(this);t.isTrigger=!0,this.addComponent(this.sprite),this.addComponent(t)}activeSpring(){this.sprite.setSprite("assets/images/spring-1.png")}}class st{static init(t,e){this.isInitialGenerated=!1,this.player=t,this.enviroment=e,this.platforms=[]}static update(){for(let t=0;t<this.platforms.length;t++)this.platforms[t].active&&this.platforms[t].transform.position.y+this.platformSprite.height/2<-d.size.y/2&&ot.releasePlatform(this.platforms[t]);this.isInitialGenerated&&this.player.transform.position.y+this.maxDistance>this.previousPlatformGenerated.transform.position.y&&(this.spawnPlatform(),o.RandomPercent(10)&&it.spawnObstacle())}static spawnPlatform(){let t=null;const e=[...J.getPlaformTypes($.getScore())];switch(this.previousPlatformGenerated instanceof q&&(e[2]=0),o.WeightPick(e)){case 0:t=ot.basePlatformsPool.get(),this.addPowerUp(t);break;case 1:t=ot.brownPlatformsPool.get();break;case 2:t=ot.bluePlatformsPool.get(),this.addPowerUp(t);break;case 3:t=ot.whitePlatformsPool.get();break;default:t=ot.basePlatformsPool.get()}this.setPlatformPosition(t,$.getScore()),this.previousPlatformGenerated=t}static setPlatformPosition(t,e){t.transform.position=new p(o.RandomFloat(-d.size.x/2+20,d.size.x/2-20),this.previousPlatformGenerated.transform.position.y+o.RandomFloat(J.getPlatfomSpawnDistances(e).x,t instanceof q?J.getPlatfomSpawnDistances(e).y/1.5:J.getPlatfomSpawnDistances(e).y))}static readySpawn(){this.reset();const t=ot.basePlatformsPool.get();t.transform.position=new p(-80,-200),this.platformSprite=t.getComponent("Sprite")}static playingStateSpawn(){this.reset(),this.enviroment.transform.position=p.zero;const t=ot.basePlatformsPool.get();t.transform.position=new p(0,-200),this.platformSprite=t.getComponent("Sprite"),this.previousPlatformGenerated=t;for(let t=0;t<20;t++)this.spawnPlatform();this.maxDistance=this.previousPlatformGenerated.transform.position.y-this.player.transform.position.y,this.isInitialGenerated=!0}static reset(){for(const t of this.platforms)ot.releasePlatform(t)}static addPowerUp(t){if(this.platforms.length>20&&o.RandomPercent(10))switch(o.WeightPick(J.powerUpSpawnChances)){case 0:t.addPowerUp(new et);break;case 1:t.addPowerUp(new Z);break;case 2:t.addPowerUp(new tt)}}}class it{static init(){this.obstacles=[]}static spawnObstacle(){let t=null;switch(o.WeightPick(J.getObstacleTypes($.getScore()))){case 0:break;case 1:default:t=ot.holePool.get();break;case 2:t=ot.monsterPool.get()}if(t){const e=t.getComponent("Sprite");t.transform.position=st.previousPlatformGenerated.transform.position.add(new p(o.RandomFloat(-d.size.x/2+e.width,d.size.x/2-e.width),200))}}static reset(){for(const t of this.obstacles)ot.releaseObstacle(t)}}class ot{static init(t){this.basePlatformsPool=new z((()=>{const e=new k;return e.setParent(t),st.platforms.push(e),e}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.bluePlatformsPool=new z((()=>{const e=new V;return e.setParent(t),st.platforms.push(e),e}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.brownPlatformsPool=new z((()=>{const e=new q;return e.setParent(t),st.platforms.push(e),e}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.whitePlatformsPool=new z((()=>{const e=new X;return e.setParent(t),st.platforms.push(e),e}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.holePool=new z((()=>{const e=new F;return e.setParent(t),it.obstacles.push(e),e}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.monsterPool=new z((()=>{const e=new H;return e.setParent(t),it.obstacles.push(e),e}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)}))}static releasePlatform(t){switch(t.name){case"BasePlatform":this.basePlatformsPool.release(t);break;case"BluePlatform":this.bluePlatformsPool.release(t);break;case"BrownPlatform":this.brownPlatformsPool.release(t);break;case"WhitePlatform":this.whitePlatformsPool.release(t)}}static releaseObstacle(t){switch(t.name){case"Hole":this.holePool.release(t);break;case"Monster":this.monsterPool.release(t)}}}class at{getMovementInput(){if(y.getKey("KeyD")||y.getKey("ArrowRight"))return 1;if(y.getKey("KeyA")||y.getKey("ArrowLeft"))return-1;if(y.isTouching){const t=y.getTouch();return t.position.x>0?1:t.position.x<0?-1:0}return 0}}class nt extends _{constructor(){super("Player"),this.OnTriggerStay=e=>{if(e.gameObject instanceof k&&this.isFalling&&!this.isMonsterTouched){if(this.transform.position.y-this.collider.size.y/2<e.gameObject.transform.position.y)return;"BrownPlatform"==e.gameObject.name?e.gameObject.setIsBreaking(!0):(this.jump(5),"WhitePlatform"==e.gameObject.name?(ot.whitePlatformsPool.release(e.gameObject),n.playWhiteSound()):n.playJumpSound())}else"Spring"===e.gameObject.name&&this.isFalling&&!this.isMonsterTouched&&(e.gameObject.activeSpring(),this.jump(8),n.playSpringSound());this.isImmortal||("Hat"!==e.gameObject.name||this.isMonsterTouched?"Jetpack"!==e.gameObject.name||this.isMonsterTouched?"Hole"!==e.gameObject.name||this.isHoleTouched?"Monster"!==e.gameObject.name||this.isMonsterTouched||(this.transform.position.y-this.collider.size.y/2>e.gameObject.transform.position.y&&this.isFalling?(this.jump(5),n.playJumpOnMonsterSound()):(this.isMonsterTouched=!0,n.playMonsterHitSound())):(this.isHoleTouched=!0,this.rigidBody.gravityScale=0,this.rigidBody.velocity=p.zero,n.playHoleSound(),new G(this.transform,1).to({scale:0,rotation:20}).setEasing(O.OUT_QUART).onComplete((()=>{r.updateGameState(t.GAME_OVER)}))):(this.jetpackTimer=2.5,e.gameObject.setActive(!1),this.jump(25),n.playJetpackSound()):(this.hatTimer=2.5,e.gameObject.setActive(!1),this.rigidBody.velocity=p.zero,n.playHatSound()))},this.OnGameStateChanged=e=>{switch(e){case t.READY:this.transform.position=new p(-80,0),this.transform.scale=1,this.transform.rotation=0,this.rigidBody.velocity=p.zero,this.rigidBody.gravityScale=.08;break;case t.PLAYING:this.isHoleTouched=!1,this.isMonsterTouched=!1,this.transform.scale=1,this.transform.rotation=0,this.transform.position=p.zero,this.rigidBody.velocity=p.zero,this.rigidBody.gravityScale=.08;break;case t.GAME_OVER:this.gameOverDelayTimer=.5}},this.rigidBody=new L(this,.08),this.sprite=new v(this,1),this.sprite.setSprite("assets/images/lik-left.png"),this.collider=new P(this),this.collider.isTrigger=!0,this.collider.scale=new p(.5,1),this.addComponent(this.sprite),this.addComponent(this.rigidBody),this.addComponent(this.collider),this.isHoleTouched=!1,this.isMonsterTouched=!1,r.OnGameStateChanged.subscribe(this.OnGameStateChanged),this.playerInput=new at}update(){if(super.update(),this.hatTimer-=h.deltaTime,this.jetpackTimer-=h.deltaTime,this.gameOverDelayTimer-=h.deltaTime,this.hatTimer>0&&this.rigidBody.addForce(p.up.mul(12*h.deltaTime),D.Force),r.getGameState()!==t.READY&&!this.isHoleTouched&&!this.isMonsterTouched){const t=2*this.playerInput.getMovementInput();this.rigidBody.velocity=new p(t,this.rigidBody.velocity.y),t>0?this.sprite.flipX=!0:t<0&&(this.sprite.flipX=!1)}(this.transform.position.y>=0||r.getGameState()===t.GAME_OVER&&this.gameOverDelayTimer>0)&&(this.transform.position=new p(this.transform.position.x,0)),this.transform.position.x+this.sprite.width/2<-d.size.x/2&&(this.transform.position=new p(d.size.x/2+this.sprite.width/2,this.transform.position.y)),this.transform.position.x-this.sprite.width/2>d.size.x/2&&(this.transform.position=new p(-d.size.x/2-this.sprite.width/2,this.transform.position.y)),this.transform.position.y+this.sprite.height/2<-d.size.y/2&&(r.getGameState()!==t.PLAYING&&r.getGameState()!==t.READY||r.updateGameState(t.GAME_OVER))}jump(t){this.rigidBody.addForce(new p(0,t),D.VelocityChange)}get isFalling(){return this.rigidBody.velocity.y<0}get isImmortal(){return this.hatTimer>0||this.jetpackTimer>0}}class rt extends _{constructor(){super("BlackImage"),this.sprite=new v(this,0),this.sprite.setSprite("assets/images/black-image.png"),this.sprite.alpha=0}update(){super.update()}show(){new G(this.sprite,1).to({alpha:1}).onComplete((()=>{r.updateGameState(t.PLAYING),new G(this.sprite,0).to({alpha:0})}))}}class ht extends _{constructor(t,e){super(t),this.sprite=new v(this,0),this.sprite.setSprite(e),this.addComponent(this.sprite),c.registerButton(this)}get width(){return this.sprite.width*this.transform.scale}get height(){return this.sprite.height*this.transform.scale}}const ct="assets/images/play.png";class lt extends ht{constructor(){super("PlayButton",ct)}onEnabled(){this.sprite.setSprite(ct)}onClick(){this.sprite.setSprite("assets/images/play-on.png"),St.Find("BlackImage").show()}}class pt extends x{constructor(){super("MainMenuScene"),this.OnGameStateChanged=e=>{switch(e){case t.READY:this.playButton.setActive(!0),this.title.setActive(!0);break;case t.PLAYING:this.playButton.setActive(!1),this.title.setActive(!1)}},this.playButton=new lt,this.playButton.transform.position=new p(-45,90),this.playButton.dontDestroyOnLoad=!0;const e=new nt;e.transform.position=new p(-80,0),this.title=new _("Title");const s=new v(this.title,0);s.setSprite("assets/images/doodle-jump.png"),this.title.addComponent(s),this.title.transform.position=new p(-45,150);const i=new k;i.transform.position=new p(-80,-200);const o=new N;o.dontDestroyOnLoad=!0;const a=new rt;a.dontDestroyOnLoad=!0,this.registerGameObject(e),this.registerGameObject(this.playButton),this.registerGameObject(this.title),this.registerGameObject(i),this.registerGameObject(o),this.registerGameObject(a),new G(this.title.transform,1).to({position:p.zero}).setLoops(-1,S.YOYO).setEasing(O.OUT_BOUNCE),r.OnGameStateChanged.subscribe(this.OnGameStateChanged)}}class dt extends _{constructor(t){super("Enviroment"),this.player=t,this.playerRb=this.player.getComponent("RigidBody"),this.rigidBody=new L(this,.08),this.addComponent(this.rigidBody)}update(){super.update(),this.rigidBody.velocity=p.zero,this.rigidBody.gravityScale=0,r.getGameState()!==t.GAME_OVER&&this.player.transform.position.y>=0&&!this.player.isFalling?(this.rigidBody.gravityScale=.08,this.rigidBody.velocity=new p(0,-this.playerRb.velocity.y)):r.getGameState()===t.GAME_OVER&&this.rigidBody.addForce(p.up.mul(20),D.VelocityChange)}point(){return-this.transform.position.y}}class ut extends _{constructor(){super("PlatformGenerator"),this.OnGameStateChange=e=>{switch(e){case t.READY:this.handleReady();break;case t.PLAYING:this.handlePlaying()}};const e=St.Find("Enviroment"),s=St.Find("Player");ot.init(e),st.init(s,e),it.init(),r.OnGameStateChanged.subscribe(this.OnGameStateChange)}update(){super.update(),st.update()}handlePlaying(){st.playingStateSpawn()}handleReady(){st.readySpawn(),it.reset()}}class mt extends ht{constructor(){super("ReturnMenuButton","assets/images/menu.png")}onClick(){r.updateGameState(t.READY)}}const gt=new p(0,-500);class yt extends _{constructor(){super("GameOverCanvas"),this.OnGameStateChanged=e=>{switch(e){case t.READY:this.setActive(!1);break;case t.PLAYING:this.setActive(!1),this.transform.position=gt;break;case t.GAME_OVER:this.setActive(!0),new G(this.transform,1).to({position:p.zero}).setEasing(O.OUT_QUART),this.scoreText.text="your score: "+$.getScore(),this.highScoreText.text="your high score: "+$.getHighScore()}};const e=i.getSceneByName("GameplayScene");e&&(this.scene=e),this.playButton=new lt,this.returnMenuButton=new mt,this.playButton.transform.position=new p(30,-120),this.returnMenuButton.transform.position=new p(100,-170),this.scoreText=new W,this.highScoreText=new W,this.scoreText.transform.position=new p(-100,30),this.highScoreText.transform.position=new p(-125,-10),this.scoreText.font="600 30px DoodleJump",this.highScoreText.font="600 30px DoodleJump",this.playButton.setParent(this),this.returnMenuButton.setParent(this),this.scoreText.setParent(this),this.highScoreText.setParent(this),this.transform.position=gt,r.OnGameStateChanged.subscribe(this.OnGameStateChanged)}setActive(t){super.setActive(t),this.playButton.setActive(t),this.returnMenuButton.setActive(t),this.scoreText.setActive(t),this.highScoreText.setActive(t)}}class ft extends _{constructor(){super("TopBar");const t=new v(this,0);t.setSprite("assets/images/top-score.png"),this.addComponent(t),this.transform.position=new p(0,d.size.y/2-t.height/2)}}class wt extends x{constructor(){super("GameplayScene");const t=new nt;this.registerGameObject(new ft),this.registerGameObject(t),this.registerGameObject(new dt(t)),this.registerGameObject(new ut),this.registerGameObject(new yt),this.registerGameObject(new $)}}const Ot=["assets/images/green-platform.png","assets/images/blue-platform.png","assets/images/brown-platform-0.png","assets/images/brown-platform-1.png","assets/images/brown-platform-2.png","assets/images/brown-platform-3.png","assets/images/white-platform.png","assets/images/lik-left.png","assets/images/spring-0.png","assets/images/spring-1.png","assets/images/hat.png","assets/images/jetpack.png","assets/images/play-on.png","assets/images/top-score.png","assets/images/doodle-jump.png","assets/images/play.png","assets/images/play-on.png","assets/images/monster-1.png","assets/images/hole.png"];class St{constructor(){this.loadAssets().then((()=>this.initializeGame())).then((()=>this.setGameReady())).then((()=>this.startGameLoop())).catch((t=>console.error("An error occurred:",t)))}loadAssets(){return b.init(),n.init().then((()=>b.load(Ot))).then((()=>{console.log("Asset loaded")}))}initializeGame(){return h.init(),l.init(),c.init(),d.init("game"),y.init(),u.init(),f.init(),u.add("Background"),m.setInteractiveLayer("Background","Background",!1),r.init(),i.init(),console.log("Game initialized"),Promise.resolve()}setGameReady(){return r.updateGameState(t.READY),new pt,new wt,console.log("Game is ready"),Promise.resolve()}startGameLoop(){this.loop()}loop(){h.deltaTime>=1/300&&(m.update(),f.update(),i.update(),d.draw(),y.reset(),h.lastFrameTime=window.performance.now()),window.requestAnimationFrame((()=>{this.loop()}))}static registerGameObject(t){St.gameObjects.push(t)}static unregisterGameObject(t){St.gameObjects.slice(St.gameObjects.indexOf(t),1)}static Find(t){for(let e=0;e<St.gameObjects.length;e++)if(St.gameObjects[e].name==t)return St.gameObjects[e];return null}}St.gameObjects=[],new St})();