(()=>{"use strict";var t,e,s={d:(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};s.d({},{l:()=>et});class i{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)}invoke(t){for(const e of this.listeners)e(t)}}class a{static get bounciness(){return.75}static registerCollider(t){a.colliders.push(t)}static registerInteractiveLayer(t){for(const e of n.layers)a.interactiveLayers[e+","+t]=!0,a.interactiveLayers[t+","+e]=!0;a.interactiveLayers[t+","+t]=!0}static setInteractiveLayer(t,e,s){a.interactiveLayers[t+","+e]=s,a.interactiveLayers[e+","+t]=s}static checkInteractiveLayer(t,e){return a.interactiveLayers[t+","+e]}static update(){for(let t=0;t<a.colliders.length-1;t++)for(let e=t+1;e<a.colliders.length;e++)a.colliders[t].gameObject.active&&a.colliders[e].gameObject.active&&this.checkInteractiveLayer(a.colliders[t].gameObject.layer,a.colliders[e].gameObject.layer)&&this.checkCollider(a.colliders[t],a.colliders[e])&&(a.colliders[t].colliding(a.colliders[e]),a.colliders[e].colliding(a.colliders[t]))}static checkCollider(t,e){const s=t.gameObject.transform.position,i=e.gameObject.transform.position;return s.x+t.size.x/2>=i.x-e.size.x/2&&s.x-t.size.x/2<=i.x+e.size.x/2&&s.y+t.size.y/2>=i.y-e.size.y/2&&s.y-t.size.y/2<=i.y+e.size.y/2}}a.colliders=[],a.interactiveLayers={};class n{static init(){n.add("Default")}static add(t){a.registerInteractiveLayer(t),this._layers.push(t)}static remove(t){this._layers.splice(this._layers.indexOf(t))}static get layers(){return this._layers}}n._layers=[],function(t){t[t.Ready=0]="Ready",t[t.Playing=1]="Playing",t[t.GameOver=2]="GameOver",t[t.Pause=3]="Pause"}(t||(t={}));class r{static init(){r._buttons=[]}static add(t){this._buttons.push(t)}static get buttons(){return r._buttons}}class o{constructor(t,e){this._x=t,this._y=e}add(t){return new o(this._x+t._x,this._y+t._y)}sub(t){return new o(this._x-t._x,this._y-t._y)}mul(t){return new o(this._x*t,this._y*t)}static get zero(){return new o(0,0)}static get up(){return new o(0,1)}static get left(){return new o(-1,0)}static get right(){return new o(1,0)}get x(){return this._x}get y(){return this._y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalize(){const t=this.magnitude;return 0!==t?new o(this._x/t,this._y/t):o.zero}dot(t){return this._x*t._x+this._y*t._y}}class h{static init(t){this.canvas=document.getElementById(t),this.canvas.width=h.size.x,this.canvas.height=h.size.y,this.canvas.addEventListener("click",h.handleClick),h.context=this.canvas.getContext("2d")}static draw(){if(h.context){for(const t of this.sprites){const e=t.gameObject;if(!e.active)continue;const s=this.size.x/2,i=this.size.y/2,a=t.width/2*e.transform.scale,n=t.height/2*e.transform.scale,r=e.transform.position.x+s,o=-e.transform.position.y+i;h.context.save(),h.context.globalAlpha=t.alpha,h.context.translate(r,o),h.context.rotate(e.transform.rotation),t.flipX&&h.context.scale(-1,1),t.flipY&&h.context.scale(1,-1),t.image.complete&&0!==t.image.naturalWidth&&h.context.drawImage(t.image,-a,-n,t.width*e.transform.scale,t.height*e.transform.scale),h.context.restore()}for(const t of this.texts)h.context.font=t.font,h.context.fillText(t.text,t.transform.position.x,t.transform.position.y)}}static registerSprite(t){h.sprites.push(t),h.sprites.sort(((t,e)=>e.order-t.order))}static registerText(t){h.texts.push(t)}static handleClick(t){const e=new o(t.offsetX-h.size.x/2,-t.offsetY+h.size.y/2);for(const t of r.buttons){if(!t.active)return;const s=t.transform.position;e.x>=s.x-t.width/2&&e.x<=s.x+t.width/2&&e.y>=s.y-t.height/2&&e.y<=s.y+t.height/2&&t.onClick()}}}h.size=new o(320,512),h.sprites=[],h.texts=[];class c{constructor(t){this.gameObject=t}update(){}destroy(){}}class l extends c{constructor(t,e){super(t),this._image=new Image,this.order=e,this.name="Sprite",this.flipX=!1,this.flipY=!1,this.alpha=1,h.registerSprite(this)}setSprite(t){this._image.src=t}get width(){return this._image.width}get height(){return this._image.height}get image(){return this._image}}class p extends c{constructor(t){super(t),this.name="Transform",this._position=o.zero,this.rotation=0,this.scale=1,this.localPosition=o.zero}update(){null!==this.gameObject.parent&&(this.position=this.gameObject.parent.transform.position.add(this.localPosition))}set position(t){this.localPosition=t.sub(this.gameObject.parent?this.gameObject.parent.transform.position:o.zero),this._position=t}get position(){return this._position}}class u{constructor(t){this.parent=null,this.children=[],this.transform=new p(this),this.name=t,this.layer="Default",this.components={},this.isActive=!0,this.addComponent(this.transform),et.registerGameObject(this)}update(){for(const t in this.components)this.active&&this.components[t].update()}addComponent(t){this.components[t.name]=t,"Collider"===t.name&&(t.OnCollisionStay.subscribe(this.OnCollisionStay),t.OnTriggerStay.subscribe(this.OnTriggerStay))}getComponent(t){return this.components[t]}executeStart(){this.start();for(let t=0;t<this.children.length;t++)this.children[t].executeStart()}executeUpdate(){if(this.active){this.update();for(let t=0;t<this.children.length;t++)this.children[t].executeUpdate()}}setChild(t){this.children.includes(t)||(this.children.push(t),t.parent=this)}removeChild(t){this.children.includes(t)&&this.children.splice(this.children.indexOf(t),1)}setParent(t){t.setChild(this)}setActive(t){this.isActive=t,this.active?this.onEnabled():this.onDisabled()}get active(){return this.isActive}start(){}onEnabled(){}onDisabled(){}OnCollisionStay(t){}OnTriggerStay(t){}destroy(){this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy();et.unregisterGameObject(this)}}class d extends u{constructor(){super("Background"),this.transform.scale=.5;const t=new l(this,3);t.setSprite("assets/images/bck.png"),this.addComponent(t)}}class m extends c{constructor(t){super(t),this.OnCollisionStay=new i,this.OnTriggerStay=new i,this.scale=new o(1,1),this.isTrigger=!1,this.name="Collider",a.registerCollider(this)}get size(){const t=this.gameObject.getComponent("Sprite");return new o(t.width*this.scale.x,t.height*this.scale.y)}update(){super.update()}colliding(t){if(t.gameObject.active)if(this.isTrigger)this.OnTriggerStay.invoke(t);else{const e=this.gameObject.getComponent("RigidBody");if(!e)return;if(e.isStatic)return;const s=t.gameObject.getComponent("RigidBody"),i=(s?s.velocity:o.zero).sub(e.velocity.mul(a.bounciness));e.velocity=i.magnitude<.005?o.zero:i,this.OnCollisionStay.invoke(t)}}}class g{static init(){g.startTime=window.performance.now(),g.lastFrameTime=0}static get time(){return(window.performance.now()-g.startTime)/1e3}static get deltaTime(){return(window.performance.now()-g.lastFrameTime)/1e3}}!function(t){t[t.Force=0]="Force",t[t.VelocityChange=1]="VelocityChange"}(e||(e={}));class y extends c{constructor(t,e){super(t),this.name="RigidBody",this.gravityScale=e,this.velocity=o.zero,this.isStatic=!1}addForce(t,s=e.Force){s==e.Force?this.velocity=this.velocity.add(t):s==e.VelocityChange&&(this.velocity=new o(t.x,t.y))}update(){this.gravityScale&&(this.velocity=this.velocity.add(new o(0,-100*this.gravityScale).mul(g.deltaTime))),this.velocity.magnitude>.1&&(this.gameObject.transform.position=this.gameObject.transform.position.add(this.velocity.mul(100*g.deltaTime)))}}class w{static init(){document.addEventListener("keydown",(t=>this.handleKeyDown(t))),document.addEventListener("keyup",(t=>this.handleKeyUp(t))),document.addEventListener("mousedown",(()=>this.handleMouseDown())),document.addEventListener("mouseup",(()=>this.handleMouseUp())),document.addEventListener("touchstart",(()=>this.handleMouseDown())),document.addEventListener("touchend",(()=>this.handleMouseUp())),this.isHeld=!1}static getKeyDown(t){return this.previousKeyStates.has(t)}static getKey(t){return this.heldKeyStates.has(t)}static getMouseDown(){return this.isMouseDown}static handleKeyDown(t){const e=t.code;this.heldKeyStates.has(e)||this.heldKeyStates.add(e),this.isHeld||this.previousKeyStates.has(e)||(this.isHeld=!0,this.previousKeyStates.add(e))}static handleKeyUp(t){const e=t.code;this.isHeld=!1,this.heldKeyStates.delete(e)}static handleMouseDown(){this.isMouseDown=!0}static handleMouseUp(){this.isMouseDown=!1}static reset(){this.previousKeyStates.clear(),this.isMouseDown=!1}}w.previousKeyStates=new Set,w.heldKeyStates=new Set;class f{static RandomFloat(t,e){return Math.random()*(e-t)+t}static RandomInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static RandomPercent(t){return this.RandomFloat(0,100)<=t}static Lerp(t,e,s){return t+(e-t)*Math.max(0,Math.min(1,s))}static WeightPick(t){let e=0;const s=[];for(let i=0;i<t.length;i++)e+=t[i],s[i]=e;const i=this.RandomFloat(0,1)*e;for(let t=0;t<s.length;t++)if(s[t]>=i)return t;return-1}}class O{static init(){this.hatAudio=new Audio("assets/audios/propeller.mp3"),this.jetpackAudio=new Audio("assets/audios/jetpack.mp3"),this.fallingAudio=new Audio("assets/audios/falling.mp3")}static playJumpSound(){const t=new Audio("assets/audios/jump.mp3");t.volume=.5,t.playbackRate=f.RandomFloat(.9,1.1),t.play()}static playSpringSound(){const t=new Audio("assets/audios/spring.mp3");t.volume=.5,t.playbackRate=f.RandomFloat(.9,1.1),t.play()}static playWhiteSound(){const t=new Audio("assets/audios/white.mp3");t.volume=.4,t.playbackRate=f.RandomFloat(.9,1.1),t.play()}static playHatSound(){this.hatAudio.volume=.2,this.hatAudio.play()}static playJetpackSound(){this.jetpackAudio.volume=.2,this.jetpackAudio.play()}static playGameOverSound(){this.fallingAudio.volume=.2,this.fallingAudio.play()}static playBreakSound(){const t=new Audio("assets/audios/break_platform.mp3");t.volume=.5,t.playbackRate=f.RandomFloat(.9,1.1),t.play()}}class v extends u{constructor(){super("BasePlatform"),this.onDisabled=()=>{this.powerUp&&this.powerUp.setActive(!1)};const t=new m(this);t.isTrigger=!0,this.sprite=new l(this,2),this.sprite.setSprite("assets/images/green-platform.png"),this.addComponent(this.sprite),this.addComponent(t)}addPowerUp(t){this.setChild(t);const e=t.getComponent("Sprite");t.transform.localPosition=new o(f.RandomFloat(-this.sprite.width/2+e.width/2,this.sprite.width/2-e.width/2),this.sprite.height/2+e.height/2-2),this.powerUp=t}}class b{constructor(t,e,s){this.pool=[],this.createObject=t,this.getObject=e,this.resetObject=s}get(){let t=null;return t=0===this.pool.length?this.createObject():this.pool.pop(),this.getObject(t),t}release(t){-1===this.pool.indexOf(t)&&(this.resetObject(t),this.pool.push(t))}clear(){this.pool.length=0}}class S{static getPlaformTypes(t){for(const e in this.scoreToPlatformTypeSpawn)if(t<parseFloat(e))return this.scoreToPlatformTypeSpawn[e];const e=Object.keys(this.scoreToPlatformTypeSpawn),s=e[e.length-1];return this.scoreToPlatformTypeSpawn[parseFloat(s)]}static getPlatfomSpawnDistances(t){for(const e in this.scoreToPlatfomSpawnDistances)if(t<parseFloat(e))return this.scoreToPlatfomSpawnDistances[e];const e=Object.keys(this.scoreToPlatfomSpawnDistances),s=e[e.length-1];return this.scoreToPlatfomSpawnDistances[parseFloat(s)]}}S.powerUpSpawnChances=[85,10,5],S.obstacleSpawnChances=[100,0],S.scoreToPlatfomSpawnDistances={1e3:new o(20,50),3e3:new o(20,55),6e3:new o(20,60),8e3:new o(20,70),1e4:new o(20,80),15e3:new o(30,90),2e4:new o(30,100)},S.scoreToPlatformTypeSpawn={1e3:[90,10,0,0],4e3:[85,10,5,0],8e3:[60,10,40,0],12e3:[30,10,70,0],2e4:[50,10,10,30]};class x extends u{constructor(){super("Spring"),this.sprite=new l(this,2),this.sprite.setSprite("assets/images/spring-0.png");const t=new m(this);t.isTrigger=!0,this.addComponent(this.sprite),this.addComponent(t)}activeSpring(){this.sprite.setSprite("assets/images/spring-1.png")}}const P=new o(50,200);class C extends v{constructor(){super(),this.name="BluePlatform",this.sprite.setSprite("assets/images/blue-platform.png"),this.moveDirection=o.right}update(){super.update(),this.transform.position.x>h.size.x/2?this.moveDirection=o.left:this.transform.position.x<-h.size.x/2&&(this.moveDirection=o.right),this.transform.position=this.transform.position.add(this.moveDirection.mul(f.RandomFloat(P.x,P.y)*g.deltaTime))}}const I=["assets/images/brown-platform-0.png","assets/images/brown-platform-1.png","assets/images/brown-platform-2.png","assets/images/brown-platform-3.png"];class k extends v{constructor(){super(),this.name="BrownPlatform",this.sprite.setSprite(I[0]),this.spriteIndex=0,this.isBreaking=!1,this.timer=.02,this.rigidBody=new y(this,0),this.addComponent(this.rigidBody)}onEnabled(){super.onEnabled(),this.isBreaking=!1,this.rigidBody.gravityScale=0,this.rigidBody.velocity=o.zero,this.spriteIndex=0,this.sprite.setSprite(I[0])}setIsBreaking(t){this.isBreaking!==t&&(this.isBreaking=t,this.isBreaking&&(O.playBreakSound(),this.rigidBody.gravityScale=.08))}update(){super.update(),this.timer-=g.deltaTime,this.isBreaking&&this.timer<0&&(this.timer=.02,++this.spriteIndex<I.length&&this.sprite.setSprite(I[this.spriteIndex]))}}class B extends u{constructor(){super("Hat");const t=new l(this,2);t.setSprite("assets/images/hat.png");const e=new m(this);e.isTrigger=!0,this.addComponent(t),this.addComponent(e)}}class T extends u{constructor(){super("Jetpack");const t=new l(this,2);t.setSprite("assets/images/jetpack.png");const e=new m(this);this.addComponent(e),this.addComponent(t)}}class j extends v{constructor(){super(),this.name="WhitePlatform",this.sprite.setSprite("assets/images/white-platform.png")}}class M extends u{constructor(){super("Hole");const t=new l(this,2);t.setSprite("assets/images/hole.png");const e=new m(this);e.isTrigger=!0,this.transform.position=new o(100,-100),this.addComponent(t),this.addComponent(e)}}class G extends u{constructor(){super("Text"),this.text="",this.font="28px Arial",h.registerText(this)}}class z extends u{constructor(){super("ScoreManager"),this.enviroment=et.Find("Enviroment"),this.scoreText=new G,this.scoreText.transform.position=new o(8,27),this.scoreText.name="ScoreText",z.score=0}update(){super.update(),tt.getGameState()===t.Playing&&(z.score=this.enviroment.point()<=0?0:Math.floor(this.enviroment.point()),this.scoreText.text=z.score.toString())}static getScore(){return this.score}}class A extends u{constructor(){super("PlatformGenerator"),this.OnGameStateChange=e=>{switch(e){case t.Ready:this.handleReady();break;case t.Playing:this.handlePlaying()}},this.isInitialGenerated=!1,this.platforms=[],this.enviroment=et.Find("Enviroment"),this.player=et.Find("Player"),this.basePlatformsPools=new b((()=>{const t=new v;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.bluePlatformsPools=new b((()=>{const t=new C;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),A.brownPlatformsPools=new b((()=>{const t=new k;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),A.whitePlatformsPools=new b((()=>{const t=new j;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),tt.OnGameStateChanged.subscribe(this.OnGameStateChange)}update(){super.update();for(let t=0;t<this.platforms.length;t++)this.platforms[t].active&&this.platforms[t].transform.position.y+this.platformSprite.height/2<-h.size.y/2&&this.releasePlatform(this.platforms[t]);this.currentScore=z.getScore(),this.isInitialGenerated&&this.player.transform.position.y+this.maxDistance>this.previousPlatformGenerated.transform.position.y&&this.spawnPlatform()}spawnObstacle(){let t=null;f.WeightPick(S.obstacleSpawnChances),t=new M,t.transform.position=this.previousPlatformGenerated.transform.position,t.parent=this.enviroment}spawnPlatform(){let t=null;switch(f.WeightPick(S.getPlaformTypes(this.currentScore))){case 0:t=this.basePlatformsPools.get(),this.addPowerUp(t);break;case 1:t=A.brownPlatformsPools.get(),this.setPlatformPosition(this.basePlatformsPools.get(),this.currentScore);break;case 2:t=this.bluePlatformsPools.get(),this.addPowerUp(t);break;case 3:t=A.whitePlatformsPools.get();break;default:t=this.basePlatformsPools.get()}this.setPlatformPosition(t,this.currentScore),this.previousPlatformGenerated=t}addPowerUp(t){if(this.platforms.length>20&&f.RandomPercent(10))switch(f.WeightPick(S.powerUpSpawnChances)){case 0:t.addPowerUp(new x);break;case 1:t.addPowerUp(new B);break;case 2:t.addPowerUp(new T)}}releasePlatform(t){switch(t.name){case"BasePlatform":this.basePlatformsPools.release(t);break;case"BluePlatform":this.bluePlatformsPools.release(t);break;case"BrownPlatform":A.brownPlatformsPools.release(t);break;case"WhitePlatform":A.whitePlatformsPools.release(t)}}setPlatformPosition(t,e){t.transform.position=new o(f.RandomFloat(-h.size.x/2+20,h.size.x/2-20),this.previousPlatformGenerated.transform.position.y+f.RandomFloat(S.getPlatfomSpawnDistances(e).x,S.getPlatfomSpawnDistances(e).y))}handlePlaying(){this.reset(),this.enviroment.transform.position=o.zero;const t=this.basePlatformsPools.get();t.transform.position=new o(0,-200),this.platformSprite=t.getComponent("Sprite"),this.previousPlatformGenerated=t;for(let t=0;t<20;t++)this.spawnPlatform();this.maxDistance=this.previousPlatformGenerated.transform.position.y-this.player.transform.position.y,this.isInitialGenerated=!0}handleReady(){this.reset();const t=this.basePlatformsPools.get();t.transform.position=new o(-80,-200),this.platformSprite=t.getComponent("Sprite")}reset(){for(const t of this.platforms)this.releasePlatform(t)}}var F;!function(t){t[t.Linear=0]="Linear",t[t.InSine=1]="InSine",t[t.OutSine=2]="OutSine",t[t.InOutSine=3]="InOutSine",t[t.InQuad=4]="InQuad",t[t.OutQuad=5]="OutQuad",t[t.InOutQuad=6]="InOutQuad",t[t.InCubic=7]="InCubic",t[t.OutCubic=8]="OutCubic",t[t.InOutCubic=9]="InOutCubic",t[t.InQuart=10]="InQuart",t[t.OutQuart=11]="OutQuart",t[t.InOutQuart=12]="InOutQuart",t[t.InQuint=13]="InQuint",t[t.OutQuint=14]="OutQuint",t[t.InOutQuint=15]="InOutQuint",t[t.InExpo=16]="InExpo",t[t.OutExpo=17]="OutExpo",t[t.InOutExpo=18]="InOutExpo",t[t.InCirc=19]="InCirc",t[t.OutCirc=20]="OutCirc",t[t.InOutCirc=21]="InOutCirc",t[t.InElastic=22]="InElastic",t[t.OutElastic=23]="OutElastic",t[t.InOutElastic=24]="InOutElastic",t[t.InBack=25]="InBack",t[t.OutBack=26]="OutBack",t[t.InOutBack=27]="InOutBack",t[t.InBounce=28]="InBounce",t[t.OutBounce=29]="OutBounce",t[t.InOutBounce=30]="InOutBounce"}(F||(F={}));const E=1.70158,R=1.525*E,_=E+1,D=2*Math.PI/3,Q=2*Math.PI/4.5,L=7.5625,K=2.75;class U{static EaseFuction(t,e){switch(t){case F.Linear:return e;case F.InSine:return 1-Math.cos(e*Math.PI/2);case F.OutSine:return Math.sin(e*Math.PI/2);case F.InOutSine:return.5*(1-Math.cos(Math.PI*e/2));case F.InQuad:return e*e;case F.OutQuad:return-e*(e-2);case F.InOutQuad:return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2;case F.InCubic:return e*e*e;case F.OutCubic:return(e-1)*(e-1)*(e-1)+1;case F.InOutCubic:return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;case F.InQuart:return e*e*e*e;case F.OutQuart:return-((e-1)*(e-1)*(e-1)-1);case F.InOutQuart:return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2;case F.InQuint:return e*e*e*e*e;case F.OutQuint:return 1-Math.pow(1-e,5);case F.InOutQuint:return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2;case F.InExpo:return 0===e?0:Math.pow(2,10*e-10);case F.OutExpo:return 1===e?1:1-Math.pow(2,-10*e);case F.InOutExpo:return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2;case F.InCirc:return 1-Math.sqrt(1-Math.pow(e,2));case F.OutCirc:return Math.sqrt(1-Math.pow(e-1,2));case F.InOutCirc:return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2;case F.InBack:return _*e*e*e-E*e*e;case F.OutBack:return 1+_*Math.pow(e-1,3)+E*Math.pow(e-1,2);case F.InOutBack:return e<.5?Math.pow(2*e,2)*(7.189819*e-R)/2:(Math.pow(2*e-2,2)*((R+1)*(2*e-2)+R)+2)/2;case F.InElastic:return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*D);case F.OutElastic:return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*D)+1;case F.InOutElastic:return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Q)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Q)/2+1;case F.InBounce:return 1-this.easeOutBounce(1-e);case F.OutBounce:return this.easeOutBounce(e);case F.InOutBounce:return e<.5?(1-this.easeOutBounce(1-2*e))/2:(1+this.easeOutBounce(2*e-1))/2;default:return e}}static easeOutBounce(t){return t<1/K?L*t*t:t<2/K?L*(t-=1.5/K)*t+.75:t<2.5/K?L*(t-=2.25/K)*t+.9375:L*(t-=2.625/K)*t+.984375}}class H{static init(){this.tweens=[]}static addTween(t){this.tweens.includes(t)||this.tweens.push(t)}static removeTween(t){const e=this.tweens.indexOf(t);-1!==e&&this.tweens.splice(e,1)}static update(){for(const t of this.tweens)t.update()}}class W{constructor(t,e){this.target=t,this.duration=e,this.easing=F.Linear,this.startTime=g.time,this.properties={},H.addTween(this)}to(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(this.target,e)){const s=this.target[e],i=t[e]-s;this.properties[e]={start:s,delta:i}}return this}setEasing(t){return this.easing=t,this}onComplete(t){return this.onCompleteCallback=t,this}update(){const t=g.time-this.startTime,e=Math.min(t/this.duration,1);for(const t in this.properties)if(Object.prototype.hasOwnProperty.call(this.properties,t)){const s=this.properties[t],i=U.EaseFuction(this.easing,e)*s.delta+s.start;this.target[t]=i}e>=1&&this.complete()}complete(){var t;H.removeTween(this);for(const t in this.properties)Object.prototype.hasOwnProperty.call(this.properties,t)&&delete this.properties[t];null===(t=this.onCompleteCallback)||void 0===t||t.call(this.onCompleteCallback)}}class q extends u{constructor(){super("Player"),this.OnTriggerStay=e=>{if(e.gameObject instanceof v&&this.isFalling){if(this.transform.position.y-this.collider.size.y/2<e.gameObject.transform.position.y)return;"BrownPlatform"==e.gameObject.name?e.gameObject.setIsBreaking(!0):(this.jump(5),"WhitePlatform"==e.gameObject.name?(A.whitePlatformsPools.release(e.gameObject),O.playWhiteSound()):O.playJumpSound())}else if("Spring"===e.gameObject.name&&this.isFalling)e.gameObject.activeSpring(),this.jump(8),O.playSpringSound();else if("Hat"===e.gameObject.name){if(this.hatTimer>0)return;if(this.jetpackTimer>0)return;this.hatTimer=2.5,e.gameObject.setActive(!1),this.rigidBody.velocity=o.zero,O.playHatSound()}else if("Jetpack"===e.gameObject.name){if(this.hatTimer>0)return;if(this.jetpackTimer>0)return;this.jetpackTimer=2.5,e.gameObject.setActive(!1),this.jump(25),O.playJetpackSound()}else"Hole"!==e.gameObject.name||this.isHoleTouched||(this.isHoleTouched=!0,this.rigidBody.gravityScale=0,this.rigidBody.velocity=o.zero,new W(this.transform,1).to({scale:0,rotation:20}).setEasing(F.OutQuart).onComplete((()=>{tt.updateGameState(t.GameOver)})))},this.OnGameStateChanged=e=>{switch(e){case t.Ready:this.transform.position=new o(-80,0);break;case t.Playing:this.isHoleTouched=!1,this.transform.position=o.zero;break;case t.GameOver:this.gameOverDelayTimer=.5}},this.rigidBody=new y(this,.08),this.sprite=new l(this,1),this.sprite.setSprite("assets/images/lik-left.png"),this.collider=new m(this),this.collider.isTrigger=!0,this.collider.scale=new o(.5,1),this.addComponent(this.sprite),this.addComponent(this.rigidBody),this.addComponent(this.collider),this.isHoleTouched=!1,tt.OnGameStateChanged.subscribe(this.OnGameStateChanged)}update(){super.update(),this.hatTimer-=g.deltaTime,this.jetpackTimer-=g.deltaTime,this.gameOverDelayTimer-=g.deltaTime,this.hatTimer>0&&this.rigidBody.addForce(o.up.mul(12*g.deltaTime),e.Force),tt.getGameState()===t.Ready||this.isHoleTouched||(w.getKey("KeyD")||w.getKey("ArrowRight")?(this.rigidBody.velocity=new o(2,this.rigidBody.velocity.y),this.sprite.flipX=!0):w.getKey("KeyA")||w.getKey("ArrowLeft")?(this.rigidBody.velocity=new o(-2,this.rigidBody.velocity.y),this.sprite.flipX=!1):this.rigidBody.velocity=new o(0,this.rigidBody.velocity.y)),(this.transform.position.y>=0||tt.getGameState()===t.GameOver&&this.gameOverDelayTimer>0)&&(this.transform.position=new o(this.transform.position.x,0)),this.transform.position.x+this.sprite.width/2<-h.size.x/2&&(this.transform.position=new o(h.size.x/2+this.sprite.width/2,this.transform.position.y)),this.transform.position.x-this.sprite.width/2>h.size.x/2&&(this.transform.position=new o(-h.size.x/2-this.sprite.width/2,this.transform.position.y)),this.transform.position.y+this.sprite.height/2<-h.size.y/2&&(tt.getGameState()!==t.Playing&&tt.getGameState()!==t.Ready||tt.updateGameState(t.GameOver))}jump(t){this.rigidBody.addForce(new o(0,t),e.VelocityChange)}get isFalling(){return this.rigidBody.velocity.y<0}}class J extends u{constructor(t){super("Enviroment"),this.player=t,this.playerRb=this.player.getComponent("RigidBody"),this.rigidBody=new y(this,.08),this.addComponent(this.rigidBody)}update(){super.update(),this.rigidBody.velocity=o.zero,this.rigidBody.gravityScale=0,tt.getGameState()!==t.GameOver&&this.player.transform.position.y>=0&&!this.player.isFalling?(this.rigidBody.gravityScale=.08,this.rigidBody.velocity=new o(0,-this.playerRb.velocity.y)):tt.getGameState()===t.GameOver&&this.rigidBody.addForce(o.up.mul(20),e.VelocityChange)}point(){return-this.transform.position.y}}class V extends u{constructor(){super("TopBar");const t=new l(this,0);t.setSprite("assets/images/top-score.png"),this.addComponent(t),this.transform.position=new o(0,h.size.y/2-t.height/2)}}class X extends u{constructor(){super("BlackImage"),this.sprite=new l(this,0),this.sprite.setSprite("assets/images/black-image.png"),this.sprite.alpha=0}update(){super.update()}show(){new W(this.sprite,1).to({alpha:1}).onComplete((()=>{tt.updateGameState(t.Playing),new W(this.sprite,0).to({alpha:0})}))}}class Y extends u{constructor(t,e){super(t),this.sprite=new l(this,0),this.sprite.setSprite(e),this.addComponent(this.sprite),r.add(this)}get width(){return this.sprite.width*this.transform.scale}get height(){return this.sprite.height*this.transform.scale}}const N="assets/images/play.png";class Z extends Y{constructor(){super("PlayButton",N)}onEnabled(){this.sprite.setSprite(N)}onClick(){this.sprite.setSprite("assets/images/play-on.png"),et.Find("BlackImage").show()}}class $ extends u{constructor(){super("MainMenu"),this.OnGameStateChanged=e=>{switch(e){case t.Ready:this.playButton.setActive(!0),this.title.setActive(!0);break;case t.Playing:this.playButton.setActive(!1),this.title.setActive(!1);break;case t.GameOver:this.playButton.setActive(!0)}},this.playButton=new Z,this.title=new u("Title");const e=new l(this.title,0);e.setSprite("assets/images/doodle-jump.png"),this.title.addComponent(e),this.playButton.transform.position=new o(-45,90),this.title.transform.position=new o(-45,150),tt.OnGameStateChanged.subscribe(this.OnGameStateChanged)}}class tt{static init(){n.add("Background"),a.setInteractiveLayer("Background","Background",!1),this.OnGameStateChanged=new i;const e=new q;new d,new V,new J(e),new A,new $,this.blackImage=new X,new z,this.updateGameState(t.Ready)}static updateGameState(e){switch(this.gameState=e,this.gameState){case t.Ready:case t.Playing:break;case t.GameOver:O.playGameOverSound()}this.OnGameStateChanged.invoke(this.gameState)}static getGameState(){return this.gameState}}class et{constructor(){w.init(),g.init(),r.init(),h.init("game"),n.init(),O.init(),H.init(),tt.init(),tt.updateGameState(t.Ready),this.loop()}loop(){g.deltaTime>=1/300&&(a.update(),et.update(),H.update(),h.draw(),w.reset(),g.lastFrameTime=window.performance.now()),window.requestAnimationFrame((()=>{this.loop()}))}static update(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].executeUpdate()}static registerGameObject(t){et.gameObjects.push(t)}static unregisterGameObject(t){et.gameObjects.slice(et.gameObjects.indexOf(t),1)}static Find(t){for(let e=0;e<et.gameObjects.length;e++)if(et.gameObjects[e].name==t)return et.gameObjects[e];return null}}et.gameObjects=[],new et})();