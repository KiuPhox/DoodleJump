(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};e.d({},{l:()=>it});class s{constructor(){this.listeners=[]}subscribe(t){this.listeners.push(t)}unsubscribe(t){const e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)}invoke(t){for(const e of this.listeners)e(t)}}class i{static get bounciness(){return.75}static registerCollider(t){i.colliders.push(t)}static registerInteractiveLayer(t){for(const e of a.layers)i.interactiveLayers[e+","+t]=!0,i.interactiveLayers[t+","+e]=!0;i.interactiveLayers[t+","+t]=!0}static setInteractiveLayer(t,e,s){i.interactiveLayers[t+","+e]=s,i.interactiveLayers[e+","+t]=s}static checkInteractiveLayer(t,e){return i.interactiveLayers[t+","+e]}static update(){for(let t=0;t<i.colliders.length-1;t++)for(let e=t+1;e<i.colliders.length;e++)i.colliders[t].gameObject.active&&i.colliders[e].gameObject.active&&this.checkInteractiveLayer(i.colliders[t].gameObject.layer,i.colliders[e].gameObject.layer)&&this.checkCollider(i.colliders[t],i.colliders[e])&&(i.colliders[t].colliding(i.colliders[e]),i.colliders[e].colliding(i.colliders[t]))}static checkCollider(t,e){const s=t.gameObject.transform.position,i=e.gameObject.transform.position;return s.x+t.size.x/2>=i.x-e.size.x/2&&s.x-t.size.x/2<=i.x+e.size.x/2&&s.y+t.size.y/2>=i.y-e.size.y/2&&s.y-t.size.y/2<=i.y+e.size.y/2}}i.colliders=[],i.interactiveLayers={};class a{static init(){a.add("Default")}static add(t){i.registerInteractiveLayer(t),this._layers.push(t)}static remove(t){this._layers.splice(this._layers.indexOf(t))}static get layers(){return this._layers}}a._layers=[],function(t){t[t.Ready=0]="Ready",t[t.Playing=1]="Playing",t[t.GameOver=2]="GameOver",t[t.Pause=3]="Pause"}(t||(t={}));class n{static init(){n._buttons=[]}static add(t){this._buttons.push(t)}static get buttons(){return n._buttons}}class r{constructor(t,e){this._x=t,this._y=e}add(t){return new r(this._x+t._x,this._y+t._y)}sub(t){return new r(this._x-t._x,this._y-t._y)}mul(t){return new r(this._x*t,this._y*t)}static get zero(){return new r(0,0)}static get up(){return new r(0,1)}static get left(){return new r(-1,0)}static get right(){return new r(1,0)}get x(){return this._x}get y(){return this._y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalize(){const t=this.magnitude;return 0!==t?new r(this._x/t,this._y/t):r.zero}dot(t){return this._x*t._x+this._y*t._y}}class o{static init(t){this.canvas=document.getElementById(t),this.canvas.width=o.size.x,this.canvas.height=o.size.y,this.canvas.addEventListener("click",o.handleClick),o.context=this.canvas.getContext("2d")}static draw(){if(o.context){for(const t of this.sprites){const e=t.gameObject;if(!e.active)continue;const s=this.size.x/2,i=this.size.y/2,a=t.width/2*e.transform.scale,n=t.height/2*e.transform.scale,r=e.transform.position.x+s,h=-e.transform.position.y+i;o.context.save(),o.context.globalAlpha=t.alpha,o.context.translate(r,h),o.context.rotate(e.transform.rotation),t.flipX&&o.context.scale(-1,1),t.flipY&&o.context.scale(1,-1),t.image.complete&&0!==t.image.naturalWidth&&o.context.drawImage(t.image,-a,-n,t.width*e.transform.scale,t.height*e.transform.scale),o.context.restore()}for(const t of this.texts)o.context.font=t.font,o.context.fillText(t.text,t.transform.position.x,t.transform.position.y)}}static registerSprite(t){o.sprites.push(t),o.sprites.sort(((t,e)=>e.order-t.order))}static registerText(t){o.texts.push(t)}static handleClick(t){const e=new r(t.offsetX-o.size.x/2,-t.offsetY+o.size.y/2);for(const t of n.buttons){if(!t.active)return;const s=t.transform.position;e.x>=s.x-t.width/2&&e.x<=s.x+t.width/2&&e.y>=s.y-t.height/2&&e.y<=s.y+t.height/2&&t.onClick()}}}o.size=new r(320,512),o.sprites=[],o.texts=[];class h{constructor(t){this.gameObject=t}update(){}destroy(){}}var c;class l{static init(){this.images={}}static load(t){return e=this,s=void 0,a=function*(){const e=[];for(const s of t){const t=new Promise((t=>{const e=new Image;e.src=s,this.images[s]=e,e.onload=()=>{t()}}));e.push(t)}yield Promise.all(e),console.log("All images have been loaded")},new((i=void 0)||(i=Promise))((function(t,n){function r(t){try{h(a.next(t))}catch(t){n(t)}}function o(t){try{h(a.throw(t))}catch(t){n(t)}}function h(e){var s;e.done?t(e.value):(s=e.value,s instanceof i?s:new i((function(t){t(s)}))).then(r,o)}h((a=a.apply(e,s||[])).next())}));var e,s,i,a}static getImage(t){return this.images[t]}}l.images={};class p extends h{constructor(t,e){super(t),this.order=e,this.name="Sprite",this.flipX=!1,this.flipY=!1,this.alpha=1,o.registerSprite(this)}setSprite(t){const e=l.getImage(t);console.log(t),void 0===e?(this._image=new Image,this._image.src=t):this._image=e}get width(){return this._image.width}get height(){return this._image.height}get image(){return this._image}}class u extends h{constructor(t){super(t),this.name="Transform",this._position=r.zero,this.rotation=0,this.scale=1,this.localPosition=r.zero}update(){null!==this.gameObject.parent&&(this.position=this.gameObject.parent.transform.position.add(this.localPosition))}set position(t){this.localPosition=t.sub(this.gameObject.parent?this.gameObject.parent.transform.position:r.zero),this._position=t}get position(){return this._position}}class d{constructor(t){this.parent=null,this.children=[],this.transform=new u(this),this.name=t,this.layer="Default",this.components={},this.isActive=!0,this.addComponent(this.transform),it.registerGameObject(this)}update(){for(const t in this.components)this.active&&this.components[t].update()}addComponent(t){this.components[t.name]=t,"Collider"===t.name&&(t.OnCollisionStay.subscribe(this.OnCollisionStay),t.OnTriggerStay.subscribe(this.OnTriggerStay))}getComponent(t){return this.components[t]}executeStart(){this.start();for(let t=0;t<this.children.length;t++)this.children[t].executeStart()}executeUpdate(){if(this.active){this.update();for(let t=0;t<this.children.length;t++)this.children[t].executeUpdate()}}setChild(t){this.children.includes(t)||(this.children.push(t),t.parent=this)}removeChild(t){this.children.includes(t)&&this.children.splice(this.children.indexOf(t),1)}setParent(t){t.setChild(this)}setActive(t){this.isActive=t,this.active?this.onEnabled():this.onDisabled()}get active(){return this.isActive}start(){}onEnabled(){}onDisabled(){}OnCollisionStay(t){}OnTriggerStay(t){}destroy(){this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy();it.unregisterGameObject(this)}}class m extends d{constructor(){super("Background"),this.transform.scale=.5;const t=new p(this,3);t.setSprite("assets/images/bck.png"),this.addComponent(t)}}class g extends h{constructor(t){super(t),this.OnCollisionStay=new s,this.OnTriggerStay=new s,this.scale=new r(1,1),this.isTrigger=!1,this.name="Collider",i.registerCollider(this)}get size(){const t=this.gameObject.getComponent("Sprite");return new r(t.width*this.scale.x,t.height*this.scale.y)}update(){super.update()}colliding(t){if(t.gameObject.active)if(this.isTrigger)this.OnTriggerStay.invoke(t);else{const e=this.gameObject.getComponent("RigidBody");if(!e)return;if(e.isStatic)return;const s=t.gameObject.getComponent("RigidBody"),a=(s?s.velocity:r.zero).sub(e.velocity.mul(i.bounciness));e.velocity=a.magnitude<.005?r.zero:a,this.OnCollisionStay.invoke(t)}}}class y{static init(){y.startTime=window.performance.now(),y.lastFrameTime=0}static get time(){return(window.performance.now()-y.startTime)/1e3}static get deltaTime(){return(window.performance.now()-y.lastFrameTime)/1e3}}!function(t){t[t.Force=0]="Force",t[t.VelocityChange=1]="VelocityChange"}(c||(c={}));class f extends h{constructor(t,e){super(t),this.name="RigidBody",this.gravityScale=e,this.velocity=r.zero,this.isStatic=!1}addForce(t,e=c.Force){e==c.Force?this.velocity=this.velocity.add(t):e==c.VelocityChange&&(this.velocity=new r(t.x,t.y))}update(){this.gravityScale&&(this.velocity=this.velocity.add(new r(0,-100*this.gravityScale).mul(y.deltaTime))),this.velocity.magnitude>.1&&(this.gameObject.transform.position=this.gameObject.transform.position.add(this.velocity.mul(100*y.deltaTime)))}}class w{static init(){document.addEventListener("keydown",(t=>this.handleKeyDown(t))),document.addEventListener("keyup",(t=>this.handleKeyUp(t))),document.addEventListener("mousedown",(()=>this.handleMouseDown())),document.addEventListener("mouseup",(()=>this.handleMouseUp())),document.addEventListener("touchstart",(()=>this.handleMouseDown())),document.addEventListener("touchend",(()=>this.handleMouseUp())),this.isHeld=!1}static getKeyDown(t){return this.previousKeyStates.has(t)}static getKey(t){return this.heldKeyStates.has(t)}static getMouseDown(){return this.isMouseDown}static handleKeyDown(t){const e=t.code;this.heldKeyStates.has(e)||this.heldKeyStates.add(e),this.isHeld||this.previousKeyStates.has(e)||(this.isHeld=!0,this.previousKeyStates.add(e))}static handleKeyUp(t){const e=t.code;this.isHeld=!1,this.heldKeyStates.delete(e)}static handleMouseDown(){this.isMouseDown=!0}static handleMouseUp(){this.isMouseDown=!1}static reset(){this.previousKeyStates.clear(),this.isMouseDown=!1}}w.previousKeyStates=new Set,w.heldKeyStates=new Set;class O{static RandomFloat(t,e){return Math.random()*(e-t)+t}static RandomInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static RandomPercent(t){return this.RandomFloat(0,100)<=t}static Lerp(t,e,s){return t+(e-t)*Math.max(0,Math.min(1,s))}static WeightPick(t){let e=0;const s=[];for(let i=0;i<t.length;i++)e+=t[i],s[i]=e;const i=this.RandomFloat(0,1)*e;for(let t=0;t<s.length;t++)if(s[t]>=i)return t;return-1}}class v{static init(){this.hatAudio=new Audio("assets/audios/propeller.mp3"),this.jetpackAudio=new Audio("assets/audios/jetpack.mp3"),this.fallingAudio=new Audio("assets/audios/falling.mp3")}static playJumpSound(){const t=new Audio("assets/audios/jump.mp3");t.volume=.5,t.playbackRate=O.RandomFloat(.9,1.1),t.play()}static playSpringSound(){const t=new Audio("assets/audios/spring.mp3");t.volume=.5,t.playbackRate=O.RandomFloat(.9,1.1),t.play()}static playWhiteSound(){const t=new Audio("assets/audios/white.mp3");t.volume=.4,t.playbackRate=O.RandomFloat(.9,1.1),t.play()}static playHatSound(){this.hatAudio.volume=.2,this.hatAudio.play()}static playJetpackSound(){this.jetpackAudio.volume=.2,this.jetpackAudio.play()}static playGameOverSound(){this.fallingAudio.volume=.2,this.fallingAudio.play()}static playBreakSound(){const t=new Audio("assets/audios/break_platform.mp3");t.volume=.5,t.playbackRate=O.RandomFloat(.9,1.1),t.play()}}class b extends d{constructor(){super("BasePlatform"),this.onDisabled=()=>{this.powerUp&&this.powerUp.setActive(!1)};const t=new g(this);t.isTrigger=!0,this.sprite=new p(this,2),this.sprite.setSprite("assets/images/green-platform.png"),this.addComponent(this.sprite),this.addComponent(t)}addPowerUp(t){this.setChild(t);const e=t.getComponent("Sprite");t.transform.localPosition=new r(O.RandomFloat(-this.sprite.width/2+e.width/2,this.sprite.width/2-e.width/2),this.sprite.height/2+e.height/2-2),this.powerUp=t}}class S{constructor(t,e,s){this.pool=[],this.createObject=t,this.getObject=e,this.resetObject=s}get(){let t=null;return t=0===this.pool.length?this.createObject():this.pool.pop(),this.getObject(t),t}release(t){-1===this.pool.indexOf(t)&&(this.resetObject(t),this.pool.push(t))}clear(){this.pool.length=0}}class x{static getPlaformTypes(t){for(const e in this.scoreToPlatformTypeSpawn)if(t<parseFloat(e))return this.scoreToPlatformTypeSpawn[e];const e=Object.keys(this.scoreToPlatformTypeSpawn),s=e[e.length-1];return this.scoreToPlatformTypeSpawn[parseFloat(s)]}static getPlatfomSpawnDistances(t){for(const e in this.scoreToPlatfomSpawnDistances)if(t<parseFloat(e))return this.scoreToPlatfomSpawnDistances[e];const e=Object.keys(this.scoreToPlatfomSpawnDistances),s=e[e.length-1];return this.scoreToPlatfomSpawnDistances[parseFloat(s)]}}x.powerUpSpawnChances=[85,10,5],x.obstacleSpawnChances=[100,0],x.scoreToPlatfomSpawnDistances={1e3:new r(20,50),3e3:new r(20,55),6e3:new r(20,60),8e3:new r(20,70),1e4:new r(20,80),15e3:new r(30,90),2e4:new r(30,100)},x.scoreToPlatformTypeSpawn={1e3:[90,10,0,0],4e3:[85,10,5,0],8e3:[60,10,40,0],12e3:[30,10,70,0],2e4:[50,10,10,30]};class P extends d{constructor(){super("Spring"),this.sprite=new p(this,2),this.sprite.setSprite("assets/images/spring-0.png");const t=new g(this);t.isTrigger=!0,this.addComponent(this.sprite),this.addComponent(t)}activeSpring(){this.sprite.setSprite("assets/images/spring-1.png")}}const C=new r(50,200);class I extends b{constructor(){super(),this.name="BluePlatform",this.sprite.setSprite("assets/images/blue-platform.png"),this.moveDirection=r.right}update(){super.update(),this.transform.position.x>o.size.x/2?this.moveDirection=r.left:this.transform.position.x<-o.size.x/2&&(this.moveDirection=r.right),this.transform.position=this.transform.position.add(this.moveDirection.mul(O.RandomFloat(C.x,C.y)*y.deltaTime))}}const k=["assets/images/brown-platform-0.png","assets/images/brown-platform-1.png","assets/images/brown-platform-2.png","assets/images/brown-platform-3.png"];class B extends b{constructor(){super(),this.name="BrownPlatform",this.sprite.setSprite(k[0]),this.spriteIndex=0,this.isBreaking=!1,this.timer=.02,this.rigidBody=new f(this,0),this.addComponent(this.rigidBody)}onEnabled(){super.onEnabled(),this.isBreaking=!1,this.rigidBody.gravityScale=0,this.rigidBody.velocity=r.zero,this.spriteIndex=0,this.sprite.setSprite(k[0])}setIsBreaking(t){this.isBreaking!==t&&(this.isBreaking=t,this.isBreaking&&(v.playBreakSound(),this.rigidBody.gravityScale=.08))}update(){super.update(),this.timer-=y.deltaTime,this.isBreaking&&this.timer<0&&(this.timer=.02,++this.spriteIndex<k.length&&this.sprite.setSprite(k[this.spriteIndex]))}}class T extends d{constructor(){super("Hat");const t=new p(this,2);t.setSprite("assets/images/hat.png");const e=new g(this);e.isTrigger=!0,this.addComponent(t),this.addComponent(e)}}class j extends d{constructor(){super("Jetpack");const t=new p(this,2);t.setSprite("assets/images/jetpack.png");const e=new g(this);this.addComponent(e),this.addComponent(t)}}class M extends b{constructor(){super(),this.name="WhitePlatform",this.sprite.setSprite("assets/images/white-platform.png")}}class G extends d{constructor(){super("Hole");const t=new p(this,2);t.setSprite("assets/images/hole.png");const e=new g(this);e.isTrigger=!0,this.transform.position=new r(100,-100),this.addComponent(t),this.addComponent(e)}}class z extends d{constructor(){super("Text"),this.text="",this.font="28px Arial",o.registerText(this)}}class A extends d{constructor(){super("ScoreManager"),this.enviroment=it.Find("Enviroment"),this.scoreText=new z,this.scoreText.transform.position=new r(8,27),this.scoreText.name="ScoreText",A.score=0}update(){super.update(),et.getGameState()===t.Playing&&(A.score=this.enviroment.point()<=0?0:Math.floor(this.enviroment.point()),this.scoreText.text=A.score.toString())}static getScore(){return this.score}}class F extends d{constructor(){super("PlatformGenerator"),this.OnGameStateChange=e=>{switch(e){case t.Ready:this.handleReady();break;case t.Playing:this.handlePlaying()}},this.isInitialGenerated=!1,this.platforms=[],this.enviroment=it.Find("Enviroment"),this.player=it.Find("Player"),this.basePlatformsPools=new S((()=>{const t=new b;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),this.bluePlatformsPools=new S((()=>{const t=new I;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),F.brownPlatformsPools=new S((()=>{const t=new B;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),F.whitePlatformsPools=new S((()=>{const t=new M;return t.parent=this.enviroment,this.platforms.push(t),t}),(t=>{t.setActive(!0)}),(t=>{t.setActive(!1)})),et.OnGameStateChanged.subscribe(this.OnGameStateChange)}update(){super.update();for(let t=0;t<this.platforms.length;t++)this.platforms[t].active&&this.platforms[t].transform.position.y+this.platformSprite.height/2<-o.size.y/2&&this.releasePlatform(this.platforms[t]);this.currentScore=A.getScore(),this.isInitialGenerated&&this.player.transform.position.y+this.maxDistance>this.previousPlatformGenerated.transform.position.y&&this.spawnPlatform()}spawnObstacle(){let t=null;O.WeightPick(x.obstacleSpawnChances),t=new G,t.transform.position=this.previousPlatformGenerated.transform.position,t.parent=this.enviroment}spawnPlatform(){let t=null;switch(O.WeightPick(x.getPlaformTypes(this.currentScore))){case 0:t=this.basePlatformsPools.get(),this.addPowerUp(t);break;case 1:t=F.brownPlatformsPools.get(),this.setPlatformPosition(this.basePlatformsPools.get(),this.currentScore);break;case 2:t=this.bluePlatformsPools.get(),this.addPowerUp(t);break;case 3:t=F.whitePlatformsPools.get();break;default:t=this.basePlatformsPools.get()}this.setPlatformPosition(t,this.currentScore),this.previousPlatformGenerated=t}addPowerUp(t){if(this.platforms.length>20&&O.RandomPercent(10))switch(O.WeightPick(x.powerUpSpawnChances)){case 0:t.addPowerUp(new P);break;case 1:t.addPowerUp(new T);break;case 2:t.addPowerUp(new j)}}releasePlatform(t){switch(t.name){case"BasePlatform":this.basePlatformsPools.release(t);break;case"BluePlatform":this.bluePlatformsPools.release(t);break;case"BrownPlatform":F.brownPlatformsPools.release(t);break;case"WhitePlatform":F.whitePlatformsPools.release(t)}}setPlatformPosition(t,e){t.transform.position=new r(O.RandomFloat(-o.size.x/2+20,o.size.x/2-20),this.previousPlatformGenerated.transform.position.y+O.RandomFloat(x.getPlatfomSpawnDistances(e).x,x.getPlatfomSpawnDistances(e).y))}handlePlaying(){this.reset(),this.enviroment.transform.position=r.zero;const t=this.basePlatformsPools.get();t.transform.position=new r(0,-200),this.platformSprite=t.getComponent("Sprite"),this.previousPlatformGenerated=t;for(let t=0;t<20;t++)this.spawnPlatform();this.maxDistance=this.previousPlatformGenerated.transform.position.y-this.player.transform.position.y,this.isInitialGenerated=!0}handleReady(){this.reset();const t=this.basePlatformsPools.get();t.transform.position=new r(-80,-200),this.platformSprite=t.getComponent("Sprite")}reset(){for(const t of this.platforms)this.releasePlatform(t)}}var E;!function(t){t[t.Linear=0]="Linear",t[t.InSine=1]="InSine",t[t.OutSine=2]="OutSine",t[t.InOutSine=3]="InOutSine",t[t.InQuad=4]="InQuad",t[t.OutQuad=5]="OutQuad",t[t.InOutQuad=6]="InOutQuad",t[t.InCubic=7]="InCubic",t[t.OutCubic=8]="OutCubic",t[t.InOutCubic=9]="InOutCubic",t[t.InQuart=10]="InQuart",t[t.OutQuart=11]="OutQuart",t[t.InOutQuart=12]="InOutQuart",t[t.InQuint=13]="InQuint",t[t.OutQuint=14]="OutQuint",t[t.InOutQuint=15]="InOutQuint",t[t.InExpo=16]="InExpo",t[t.OutExpo=17]="OutExpo",t[t.InOutExpo=18]="InOutExpo",t[t.InCirc=19]="InCirc",t[t.OutCirc=20]="OutCirc",t[t.InOutCirc=21]="InOutCirc",t[t.InElastic=22]="InElastic",t[t.OutElastic=23]="OutElastic",t[t.InOutElastic=24]="InOutElastic",t[t.InBack=25]="InBack",t[t.OutBack=26]="OutBack",t[t.InOutBack=27]="InOutBack",t[t.InBounce=28]="InBounce",t[t.OutBounce=29]="OutBounce",t[t.InOutBounce=30]="InOutBounce"}(E||(E={}));const _=1.70158,R=1.525*_,D=_+1,Q=2*Math.PI/3,L=2*Math.PI/4.5,K=7.5625,U=2.75;class H{static EaseFuction(t,e){switch(t){case E.Linear:return e;case E.InSine:return 1-Math.cos(e*Math.PI/2);case E.OutSine:return Math.sin(e*Math.PI/2);case E.InOutSine:return.5*(1-Math.cos(Math.PI*e/2));case E.InQuad:return e*e;case E.OutQuad:return-e*(e-2);case E.InOutQuad:return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2;case E.InCubic:return e*e*e;case E.OutCubic:return(e-1)*(e-1)*(e-1)+1;case E.InOutCubic:return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2;case E.InQuart:return e*e*e*e;case E.OutQuart:return-((e-1)*(e-1)*(e-1)-1);case E.InOutQuart:return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2;case E.InQuint:return e*e*e*e*e;case E.OutQuint:return 1-Math.pow(1-e,5);case E.InOutQuint:return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2;case E.InExpo:return 0===e?0:Math.pow(2,10*e-10);case E.OutExpo:return 1===e?1:1-Math.pow(2,-10*e);case E.InOutExpo:return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2;case E.InCirc:return 1-Math.sqrt(1-Math.pow(e,2));case E.OutCirc:return Math.sqrt(1-Math.pow(e-1,2));case E.InOutCirc:return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2;case E.InBack:return D*e*e*e-_*e*e;case E.OutBack:return 1+D*Math.pow(e-1,3)+_*Math.pow(e-1,2);case E.InOutBack:return e<.5?Math.pow(2*e,2)*(7.189819*e-R)/2:(Math.pow(2*e-2,2)*((R+1)*(2*e-2)+R)+2)/2;case E.InElastic:return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*Q);case E.OutElastic:return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*Q)+1;case E.InOutElastic:return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*L)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*L)/2+1;case E.InBounce:return 1-this.easeOutBounce(1-e);case E.OutBounce:return this.easeOutBounce(e);case E.InOutBounce:return e<.5?(1-this.easeOutBounce(1-2*e))/2:(1+this.easeOutBounce(2*e-1))/2;default:return e}}static easeOutBounce(t){return t<1/U?K*t*t:t<2/U?K*(t-=1.5/U)*t+.75:t<2.5/U?K*(t-=2.25/U)*t+.9375:K*(t-=2.625/U)*t+.984375}}class W{static init(){this.tweens=[]}static addTween(t){this.tweens.includes(t)||this.tweens.push(t)}static removeTween(t){const e=this.tweens.indexOf(t);-1!==e&&this.tweens.splice(e,1)}static update(){for(const t of this.tweens)t.update()}}class q{constructor(t,e){this.target=t,this.duration=e,this.easing=E.Linear,this.startTime=y.time,this.properties={},W.addTween(this)}to(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(this.target,e)){const s=this.target[e],i=t[e]-s;this.properties[e]={start:s,delta:i}}return this}setEasing(t){return this.easing=t,this}onComplete(t){return this.onCompleteCallback=t,this}update(){const t=y.time-this.startTime,e=Math.min(t/this.duration,1);for(const t in this.properties)if(Object.prototype.hasOwnProperty.call(this.properties,t)){const s=this.properties[t],i=H.EaseFuction(this.easing,e)*s.delta+s.start;this.target[t]=i}e>=1&&this.complete()}complete(){var t;W.removeTween(this);for(const t in this.properties)Object.prototype.hasOwnProperty.call(this.properties,t)&&delete this.properties[t];null===(t=this.onCompleteCallback)||void 0===t||t.call(this.onCompleteCallback)}}class J extends d{constructor(){super("Player"),this.OnTriggerStay=e=>{if(e.gameObject instanceof b&&this.isFalling){if(this.transform.position.y-this.collider.size.y/2<e.gameObject.transform.position.y)return;"BrownPlatform"==e.gameObject.name?e.gameObject.setIsBreaking(!0):(this.jump(5),"WhitePlatform"==e.gameObject.name?(F.whitePlatformsPools.release(e.gameObject),v.playWhiteSound()):v.playJumpSound())}else if("Spring"===e.gameObject.name&&this.isFalling)e.gameObject.activeSpring(),this.jump(8),v.playSpringSound();else if("Hat"===e.gameObject.name){if(this.hatTimer>0)return;if(this.jetpackTimer>0)return;this.hatTimer=2.5,e.gameObject.setActive(!1),this.rigidBody.velocity=r.zero,v.playHatSound()}else if("Jetpack"===e.gameObject.name){if(this.hatTimer>0)return;if(this.jetpackTimer>0)return;this.jetpackTimer=2.5,e.gameObject.setActive(!1),this.jump(25),v.playJetpackSound()}else"Hole"!==e.gameObject.name||this.isHoleTouched||(this.isHoleTouched=!0,this.rigidBody.gravityScale=0,this.rigidBody.velocity=r.zero,new q(this.transform,1).to({scale:0,rotation:20}).setEasing(E.OutQuart).onComplete((()=>{et.updateGameState(t.GameOver)})))},this.OnGameStateChanged=e=>{switch(e){case t.Ready:this.transform.position=new r(-80,0);break;case t.Playing:this.isHoleTouched=!1,this.transform.position=r.zero;break;case t.GameOver:this.gameOverDelayTimer=.5}},this.rigidBody=new f(this,.08),this.sprite=new p(this,1),this.sprite.setSprite("assets/images/lik-left.png"),this.collider=new g(this),this.collider.isTrigger=!0,this.collider.scale=new r(.5,1),this.addComponent(this.sprite),this.addComponent(this.rigidBody),this.addComponent(this.collider),this.isHoleTouched=!1,et.OnGameStateChanged.subscribe(this.OnGameStateChanged)}update(){super.update(),this.hatTimer-=y.deltaTime,this.jetpackTimer-=y.deltaTime,this.gameOverDelayTimer-=y.deltaTime,this.hatTimer>0&&this.rigidBody.addForce(r.up.mul(12*y.deltaTime),c.Force),et.getGameState()===t.Ready||this.isHoleTouched||(w.getKey("KeyD")||w.getKey("ArrowRight")?(this.rigidBody.velocity=new r(2,this.rigidBody.velocity.y),this.sprite.flipX=!0):w.getKey("KeyA")||w.getKey("ArrowLeft")?(this.rigidBody.velocity=new r(-2,this.rigidBody.velocity.y),this.sprite.flipX=!1):this.rigidBody.velocity=new r(0,this.rigidBody.velocity.y)),(this.transform.position.y>=0||et.getGameState()===t.GameOver&&this.gameOverDelayTimer>0)&&(this.transform.position=new r(this.transform.position.x,0)),this.transform.position.x+this.sprite.width/2<-o.size.x/2&&(this.transform.position=new r(o.size.x/2+this.sprite.width/2,this.transform.position.y)),this.transform.position.x-this.sprite.width/2>o.size.x/2&&(this.transform.position=new r(-o.size.x/2-this.sprite.width/2,this.transform.position.y)),this.transform.position.y+this.sprite.height/2<-o.size.y/2&&(et.getGameState()!==t.Playing&&et.getGameState()!==t.Ready||et.updateGameState(t.GameOver))}jump(t){this.rigidBody.addForce(new r(0,t),c.VelocityChange)}get isFalling(){return this.rigidBody.velocity.y<0}}class V extends d{constructor(t){super("Enviroment"),this.player=t,this.playerRb=this.player.getComponent("RigidBody"),this.rigidBody=new f(this,.08),this.addComponent(this.rigidBody)}update(){super.update(),this.rigidBody.velocity=r.zero,this.rigidBody.gravityScale=0,et.getGameState()!==t.GameOver&&this.player.transform.position.y>=0&&!this.player.isFalling?(this.rigidBody.gravityScale=.08,this.rigidBody.velocity=new r(0,-this.playerRb.velocity.y)):et.getGameState()===t.GameOver&&this.rigidBody.addForce(r.up.mul(20),c.VelocityChange)}point(){return-this.transform.position.y}}class X extends d{constructor(){super("TopBar");const t=new p(this,0);t.setSprite("assets/images/top-score.png"),this.addComponent(t),this.transform.position=new r(0,o.size.y/2-t.height/2)}}class Y extends d{constructor(){super("BlackImage"),this.sprite=new p(this,0),this.sprite.setSprite("assets/images/black-image.png"),this.sprite.alpha=0}update(){super.update()}show(){new q(this.sprite,1).to({alpha:1}).onComplete((()=>{et.updateGameState(t.Playing),new q(this.sprite,0).to({alpha:0})}))}}class N extends d{constructor(t,e){super(t),this.sprite=new p(this,0),this.sprite.setSprite(e),this.addComponent(this.sprite),n.add(this)}get width(){return this.sprite.width*this.transform.scale}get height(){return this.sprite.height*this.transform.scale}}const Z="assets/images/play.png";class $ extends N{constructor(){super("PlayButton",Z)}onEnabled(){this.sprite.setSprite(Z)}onClick(){this.sprite.setSprite("assets/images/play-on.png"),it.Find("BlackImage").show()}}class tt extends d{constructor(){super("MainMenu"),this.OnGameStateChanged=e=>{switch(e){case t.Ready:this.playButton.setActive(!0),this.title.setActive(!0);break;case t.Playing:this.playButton.setActive(!1),this.title.setActive(!1);break;case t.GameOver:this.playButton.setActive(!0)}},this.playButton=new $,this.title=new d("Title");const e=new p(this.title,0);e.setSprite("assets/images/doodle-jump.png"),this.title.addComponent(e),this.playButton.transform.position=new r(-45,90),this.title.transform.position=new r(-45,150),et.OnGameStateChanged.subscribe(this.OnGameStateChanged)}}class et{static init(){a.add("Background"),i.setInteractiveLayer("Background","Background",!1),this.OnGameStateChanged=new s;const e=new J;new m,new X,new V(e),new F,new tt,this.blackImage=new Y,new A,this.updateGameState(t.Ready)}static updateGameState(e){switch(this.gameState=e,this.gameState){case t.Ready:case t.Playing:break;case t.GameOver:v.playGameOverSound()}this.OnGameStateChanged.invoke(this.gameState)}static getGameState(){return this.gameState}}const st=["assets/images/green-platform.png","assets/images/blue-platform.png","assets/images/brown-platform-0.png","assets/images/brown-platform-1.png","assets/images/brown-platform-2.png","assets/images/brown-platform-3.png","assets/images/white-platform","assets/images/lik-left.png","assets/images/spring-0.png","assets/images/spring-1.png","assets/images/hat.png","assets/images/jetpack.png","assets/images/play-on.png"];class it{constructor(){l.init(),l.load(st).then((()=>{w.init(),y.init(),n.init(),o.init("game"),a.init(),v.init(),W.init(),et.init(),et.updateGameState(t.Ready),this.loop()}))}loop(){y.deltaTime>=1/300&&(i.update(),it.update(),W.update(),o.draw(),w.reset(),y.lastFrameTime=window.performance.now()),window.requestAnimationFrame((()=>{this.loop()}))}static update(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].executeUpdate()}static registerGameObject(t){it.gameObjects.push(t)}static unregisterGameObject(t){it.gameObjects.slice(it.gameObjects.indexOf(t),1)}static Find(t){for(let e=0;e<it.gameObjects.length;e++)if(it.gameObjects[e].name==t)return it.gameObjects[e];return null}}it.gameObjects=[],new it})();